<!DOCTYPE html>
<html class="dark" lang="en">
<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <title>Six7 Electrical | Book Emergency Electrician Colombo | 24/7 Service</title>
  
  <!-- Tailwind + Fonts -->
  <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
  <link href="https://fonts.googleapis.com/css2?family=Public+Sans:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
  <!-- Font Awesome 6 -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

  <style>
    .circuit-pattern { 
      background-image: radial-gradient(circle at 2px 2px, rgba(232, 106, 33, 0.15) 1px, transparent 0); 
      background-size: 24px 24px; 
    }
    .step-transition {
      transition: opacity 0.3s ease-in-out;
    }
    .step-hidden {
      display: none;
      opacity: 0;
    }
    .step-visible {
      display: block;
      opacity: 1;
    }
    .hide-scrollbar::-webkit-scrollbar {
      display: none;
    }
    .hide-scrollbar {
      -ms-overflow-style: none;
      scrollbar-width: none;
    }
    .custom-checkbox:checked {
      background-image: url("data:image/svg+xml,%3csvg viewBox='0 0 16 16' fill='white' xmlns='http://www.w3.org/2000/svg'%3e%3cpath d='M12.207 4.793a1 1 0 010 1.414l-5 5a1 1 0 01-1.414 0l-2-2a1 1 0 011.414-1.414L6.5 9.086l4.293-4.293a1 1 0 011.414 0z'/%3e%3c/svg%3e");
    }
    .sticky-action-footer {
      position: sticky;
      bottom: 0;
      z-index: 40;
      background: inherit;
      border-top: 1px solid rgba(232, 106, 33, 0.1);
      box-shadow: 0 -4px 6px -1px rgba(0, 0, 0, 0.05);
    }
    .time-display-12hr {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      background-color: #1e293b;
      border: 1px solid #334155;
      border-radius: 0.75rem;
      padding: 0.75rem 1rem;
      font-size: 1.25rem;
      font-weight: 600;
      color: #f1f5f9;
    }
    .time-display-12hr .ampm {
      font-size: 0.875rem;
      color: #94a3b8;
      font-weight: 500;
      margin-left: 0.25rem;
    }
    .time-control-btn {
      padding: 0.75rem;
      border-radius: 0.75rem;
      border: 1px solid #334155;
      background: #1e293b;
      color: #cbd5e1;
      font-weight: 500;
      transition: all 0.2s;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      min-width: 5rem;
    }
    .time-control-btn:hover {
      border-color: #e86a21;
      color: #e86a21;
    }
    .error-message {
      color: #b13e3e;
      font-size: 0.75rem;
      margin-top: 0.25rem;
      display: flex;
      align-items: center;
      gap: 0.25rem;
    }
    .input-error {
      border-color: #b13e3e !important;
    }
    .location-btn {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      width: 100%;
      padding: 1rem;
      background-color: #1e293b;
      border: 2px dashed #475569;
      border-radius: 1rem;
      color: #cbd5e1;
      font-weight: 600;
      transition: all 0.2s;
      cursor: pointer;
    }
    .location-btn:hover {
      border-color: #e86a21;
      color: #e86a21;
      background-color: rgba(232, 106, 33, 0.05);
    }
    .location-result {
      margin-top: 1rem;
      padding: 1rem;
      background-color: rgba(232, 106, 33, 0.05);
      border: 1px solid rgba(232, 106, 33, 0.2);
      border-radius: 0.75rem;
      display: none;
    }
    .location-result.visible {
      display: block;
    }
    .location-link {
      display: inline-flex;
      align-items: center;
      gap: 0.25rem;
      color: #e86a21;
      font-weight: 500;
      text-decoration: none;
      margin-top: 0.5rem;
    }
    .breadcrumb {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      gap: 0.5rem;
      margin-bottom: 2rem;
      padding: 0.5rem 0;
    }
    .breadcrumb-item {
      font-size: 0.875rem;
      font-weight: 500;
      text-decoration: none;
      display: flex;
      align-items: center;
      gap: 0.25rem;
    }
    .breadcrumb-item.completed {
      color: rgba(232, 106, 33, 0.8);
    }
    .breadcrumb-item.active {
      color: #e86a21;
      font-weight: 700;
    }
    .breadcrumb-item.pending {
      color: #94a3b8;
    }
    .booking-card {
      background-color: #0a2642;
      border-radius: 1.5rem;
      padding: 1.5rem;
      box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.05);
      border: 1px solid rgba(232, 106, 33, 0.1);
    }
    @media (min-width: 768px) {
      .booking-card {
        padding: 2.5rem;
      }
    }
    .emergency-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.9);
      z-index: 10000;
      display: none;
      justify-content: center;
      align-items: center;
      padding: 20px;
    }
    .emergency-overlay.active {
      display: flex;
    }
    .emergency-card {
      background: #0a2642;
      border-radius: 2rem;
      padding: 2rem;
      max-width: 400px;
      text-align: center;
      border: 1px solid rgba(232, 106, 33, 0.3);
    }
    body {
      font-family: 'Public Sans', sans-serif;
      background-color: #0a2540;
    }
    .glass {
      backdrop-filter: blur(12px);
      background-color: #0a2642/80;
    }
    @media (max-width: 640px) {
      h1 {
        font-size: 2rem !important;
        line-height: 1.2 !important;
      }
      .booking-card {
        padding: 1.25rem;
      }
    }
    #mobile-menu-drawer {
      transition: transform 0.3s ease-in-out;
      transform: translateX(100%);
    }
    #mobile-menu-drawer.open {
      transform: translateX(0);
    }
  </style>

  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          colors: {
            'primary': '#0a2642',
            'primary-deep': '#0a2540',
            'accent-orange': '#e86a21',
            'whatsapp-green': '#25D366',
            'background-light': '#f8f7f6',
            'background-dark': '#0a2540',
            'emergency': '#b13e3e',
          },
          fontFamily: { 'display': ['Public Sans', 'sans-serif'] },
        },
      },
    };
  </script>
</head>
<body class="bg-background-dark text-slate-100 font-display antialiased min-h-screen flex flex-col">

  <!-- Emergency Overlay -->
  <div id="emergencyOverlay" class="emergency-overlay" onclick="closeEmergencyOverlay(event)">
    <div class="emergency-card">
      <div class="mb-4 p-4 rounded-full bg-emergency/10 inline-block">
        <i class="fas fa-bolt text-emergency text-5xl"></i>
      </div>
      <h2 class="text-2xl font-black text-white mb-3">Electrical Emergency Detected!</h2>
      <p class="text-slate-400 mb-6">For immediate assistance, call our 24/7 emergency line. 38-minute average response.</p>
      <a href="tel:+94758244216" class="w-full bg-emergency text-white py-4 rounded-xl font-bold text-xl mb-3 flex items-center justify-center gap-2 hover:bg-emergency/90 transition-colors">
        <i class="fas fa-phone-alt"></i>
        Call Now: +94 75 824 4216
      </a>
      <button onclick="closeEmergencyOverlay(true)" class="w-full border border-slate-700 py-3 rounded-xl font-medium text-slate-400 hover:bg-slate-800 transition-colors">
        Continue with Booking
      </button>
      <p class="text-xs text-slate-500 mt-4">No call-out fee for emergencies</p>
    </div>
  </div>

  <!-- Sticky Header -->
  <header class="sticky top-0 z-40 bg-primary/95 backdrop-blur-md border-b border-slate-700/50 px-4 py-3 flex items-center justify-between">
    <a href="#" class="flex items-center gap-2 hover:opacity-90">
      <div class="size-8 bg-accent-orange rounded-lg flex items-center justify-center text-white"><i class="fas fa-bolt text-xl"></i></div>
      <span class="font-black text-lg text-white uppercase">Six7 Electrical</span>
    </a>
    <nav class="hidden md:flex items-center gap-5 text-sm font-medium text-white/90">
      <a href="#emergency-services" class="hover:text-accent-orange transition flex items-center gap-1"><i class="fas fa-exclamation-triangle text-base"></i>Emergency</a>
      <a href="/commercial" class="hover:text-accent-orange transition">Commercial</a>
      <a href="#regular-services" class="hover:text-accent-orange transition">Services</a>
      <a href="/areas" class="hover:text-accent-orange transition">Areas</a>
      <a href="/pricing" class="hover:text-accent-orange transition">Pricing</a>
      <a href="/contact" class="hover:text-accent-orange transition">Contact</a>
    </nav>
    <button id="menuToggleBtn" class="p-2 text-white rounded-full hover:bg-white/10 transition md:hidden"><i class="fas fa-bars text-3xl"></i></button>
  </header>

  <!-- mobile drawer -->
  <div id="mobile-menu-drawer" class="fixed top-0 right-0 z-50 h-full w-64 bg-primary-deep shadow-2xl border-l border-white/10 p-6 backdrop-blur-xl transition-transform duration-300 ease-in-out translate-x-full">
    <div class="flex justify-end"><button id="closeDrawerBtn" class="text-white/70 hover:text-white"><i class="fas fa-times text-3xl"></i></button></div>
    <nav class="mt-8 flex flex-col gap-5 text-white">
      <a href="#emergency-services" class="text-base font-medium flex items-center gap-3 border-b border-white/10 pb-2"><i class="fas fa-exclamation-triangle text-accent-orange"></i> Emergency</a>
      <a href="/commercial" class="text-base font-medium flex items-center gap-3 border-b border-white/10 pb-2"><i class="fas fa-briefcase text-accent-orange"></i> Commercial</a>
      <a href="#regular-services" class="text-base font-medium flex items-center gap-3 border-b border-white/10 pb-2"><i class="fas fa-tools text-accent-orange"></i> Services</a>
      <a href="/areas" class="text-base font-medium flex items-center gap-3 border-b border-white/10 pb-2"><i class="fas fa-map-marker-alt text-accent-orange"></i> Areas</a>
      <a href="/pricing" class="text-base font-medium flex items-center gap-3 border-b border-white/10 pb-2"><i class="fas fa-tag text-accent-orange"></i> Pricing</a>
      <a href="/contact" class="text-base font-medium flex items-center gap-3 border-b border-white/10 pb-2"><i class="fas fa-envelope text-accent-orange"></i> Contact</a>
      <div class="pt-6 flex flex-col gap-3">
        <a href="tel:+94758244216" class="bg-accent-orange w-full py-3 rounded-xl font-bold flex items-center justify-center gap-2"><i class="fas fa-phone"></i> Call now</a>
        <a href="https://wa.me/94758244216" class="bg-whatsapp-green w-full py-3 rounded-xl font-bold flex items-center justify-center gap-2"><i class="fab fa-whatsapp"></i> WhatsApp</a>
      </div>
    </nav>
  </div>

  <!-- Main Content -->
  <main class="flex-1 flex items-start justify-center py-6 px-4 md:px-0">
    
    <!-- STEP 1: Welcome -->
    <div id="step-1" class="step-visible step-transition w-full max-w-[600px] mx-auto">
      <div class="booking-card circuit-pattern flex flex-col items-center text-center">
        <div class="mb-6 p-4 rounded-full bg-accent-orange/10">
          <i class="fas fa-bolt text-accent-orange text-5xl"></i>
        </div>
        <div class="space-y-3 mb-8">
          <h1 class="text-white text-4xl md:text-5xl font-extrabold tracking-tight">
            Need an <span class="text-accent-orange">electrician</span>?
          </h1>
          <p class="text-slate-400 text-lg">
            38-minute arrival guarantee. No call-out fee for emergencies.
          </p>
        </div>
        
        <div class="w-full mb-8">
          <div class="bg-emergency/10 p-4 rounded-xl border border-emergency/20 mb-6">
            <div class="flex items-center gap-3">
              <i class="fas fa-bolt text-emergency text-2xl"></i>
              <div class="text-left">
                <p class="font-bold text-emergency">Electrical emergency? Call now</p>
                <a href="tel:+94758244216" class="text-lg font-black text-white">+94 75 824 4216</a>
              </div>
            </div>
          </div>
          
          <div class="flex flex-col items-start w-full">
            <label class="text-slate-300 text-base font-semibold mb-3 ml-1" for="name-input">
              Your name <span class="text-emergency">*</span>
            </label>
            <div class="relative w-full">
              <i class="fas fa-user absolute left-4 top-1/2 -translate-y-1/2 text-slate-400"></i>
              <input class="w-full pl-12 pr-4 py-4 rounded-xl border-2 border-slate-700 bg-slate-800/50 focus:border-accent-orange focus:ring-0 transition-all text-lg placeholder:text-slate-400 text-white" id="name-input" placeholder="Enter your full name" type="text"/>
            </div>
            <div id="name-error" class="error-message hidden">
              <i class="fas fa-exclamation-circle"></i>
              <span>Please enter your name</span>
            </div>
          </div>
        </div>
        
        <div class="w-full space-y-4">
          <button onclick="validateAndNext(1)" class="w-full py-4 px-8 rounded-full bg-accent-orange text-white text-lg font-bold shadow-xl shadow-accent-orange/30 hover:shadow-accent-orange/40 active:scale-[0.98] transition-all flex items-center justify-center gap-2 group">
            <span>Start Booking</span>
            <i class="fas fa-arrow-right group-hover:translate-x-1 transition-transform"></i>
          </button>
          
          <a href="tel:+94758244216" class="w-full py-3 px-8 rounded-full border-2 border-emergency text-emergency font-bold text-base hover:bg-emergency/5 transition-colors flex items-center justify-center gap-2">
            <i class="fas fa-phone-alt"></i>
            Emergency? Call Now
          </a>
        </div>
      </div>
    </div>

    <!-- STEP 2: Contact -->
    <div id="step-2" class="step-hidden step-transition w-full max-w-[640px] mx-auto">
      <div class="booking-card">
        <div class="breadcrumb">
          <span class="breadcrumb-item completed"><i class="fas fa-check-circle text-sm"></i> Welcome</span>
          <span class="breadcrumb-separator">/</span>
          <span class="breadcrumb-item active"><i class="fas fa-circle text-sm"></i> Contact</span>
          <span class="breadcrumb-separator">/</span>
          <span class="breadcrumb-item pending">Location</span>
          <span class="breadcrumb-separator">/</span>
          <span class="breadcrumb-item pending">Service</span>
          <span class="breadcrumb-separator">/</span>
          <span class="breadcrumb-item pending">Date/Time</span>
          <span class="breadcrumb-separator">/</span>
          <span class="breadcrumb-item pending">Confirm</span>
        </div>
        
        <div class="w-full bg-slate-700 h-1.5 rounded-full mb-6 overflow-hidden">
          <div class="bg-accent-orange h-full w-1/5 rounded-full"></div>
        </div>
        
        <div class="mb-6">
          <h1 class="text-white text-3xl md:text-4xl font-black leading-tight tracking-tight mb-3">How can we reach you?</h1>
          <p class="text-slate-400 text-base">We'll confirm your booking and send updates.</p>
        </div>
        
        <div class="space-y-5">
          <div class="flex flex-col gap-1">
            <label class="flex flex-col">
              <span class="text-white text-base font-semibold mb-2 flex items-center gap-1">
                Phone Number <span class="text-emergency">*</span>
              </span>
              <div class="relative">
                <i class="fas fa-phone absolute left-4 top-1/2 -translate-y-1/2 text-slate-400"></i>
                <input class="form-input w-full rounded-lg border border-slate-700 bg-slate-800 focus:border-accent-orange focus:ring-2 focus:ring-accent-orange/20 h-14 pl-12 pr-4 text-base text-white" type="tel" id="phone-input" placeholder="+94 77 123 4567"/>
              </div>
              <div id="phone-error" class="error-message hidden">
                <i class="fas fa-exclamation-circle"></i>
                <span>Please enter a valid phone number</span>
              </div>
              <p class="text-slate-400 text-xs mt-1.5">We'll call to confirm your booking</p>
            </label>
          </div>
          
          <div class="flex flex-col gap-1">
            <label class="flex flex-col">
              <div class="flex justify-between items-center mb-2">
                <span class="text-white text-base font-semibold">Email Address</span>
                <span class="text-slate-400 text-xs font-normal italic">(Optional)</span>
              </div>
              <div class="relative">
                <i class="fas fa-envelope absolute left-4 top-1/2 -translate-y-1/2 text-slate-400"></i>
                <input class="form-input w-full rounded-lg border border-slate-700 bg-slate-800 focus:border-accent-orange focus:ring-2 focus:ring-accent-orange/20 h-14 pl-12 pr-4 text-base text-white" type="email" id="email-input" placeholder="your@email.com"/>
              </div>
              <div id="email-error" class="error-message hidden">
                <i class="fas fa-exclamation-circle"></i>
                <span>Please enter a valid email address</span>
              </div>
            </label>
          </div>
          
          <div class="p-4 bg-emergency/5 rounded-xl border border-emergency/20">
            <label class="flex items-center gap-3 cursor-pointer">
              <input type="checkbox" id="urgent-check" onchange="handleEmergencyCheck(this)" class="w-5 h-5 rounded border-emergency text-emergency focus:ring-emergency">
              <div>
                <span class="font-bold text-emergency text-sm">This is urgent / emergency</span>
                <p class="text-xs text-slate-400">Power outage, sparks, burning smell - call immediately</p>
              </div>
            </label>
          </div>
        </div>
        
        <div class="mt-6 p-3 bg-primary/5 rounded-xl border border-primary/10 flex gap-3 items-start">
          <div class="bg-primary/10 p-2 rounded-lg text-primary">
            <i class="fas fa-shield-alt"></i>
          </div>
          <div>
            <h4 class="text-white font-bold text-sm">Licensed & Insured</h4>
            <p class="text-slate-400 text-xs">All work guaranteed ‚Ä¢ 90-day workmanship warranty</p>
          </div>
        </div>
      </div>
      
      <div class="sticky-action-footer bg-primary-deep mt-6 -mx-4 px-4 py-4">
        <div class="flex flex-col gap-3">
          <button onclick="validateAndNext(2)" class="w-full bg-accent-orange hover:bg-accent-orange/90 text-white font-bold text-lg h-14 rounded-xl shadow-lg shadow-accent-orange/20 transition-all flex items-center justify-center gap-2">
            <span>Continue</span>
            <i class="fas fa-arrow-right"></i>
          </button>
          <button onclick="prevStep(2)" class="w-full text-slate-400 hover:text-white font-medium text-base py-2 transition-colors flex items-center justify-center gap-1">
            <i class="fas fa-arrow-left text-base"></i>
            Back
          </button>
        </div>
      </div>
    </div>

    <!-- STEP 3: Location -->
    <div id="step-3" class="step-hidden step-transition w-full max-w-[640px] mx-auto">
      <div class="booking-card">
        <div class="breadcrumb">
          <span class="breadcrumb-item completed"><i class="fas fa-check-circle text-sm"></i> Welcome</span>
          <span class="breadcrumb-separator">/</span>
          <span class="breadcrumb-item completed"><i class="fas fa-check-circle text-sm"></i> Contact</span>
          <span class="breadcrumb-separator">/</span>
          <span class="breadcrumb-item active"><i class="fas fa-circle text-sm"></i> Location</span>
          <span class="breadcrumb-separator">/</span>
          <span class="breadcrumb-item pending">Service</span>
          <span class="breadcrumb-separator">/</span>
          <span class="breadcrumb-item pending">Date/Time</span>
          <span class="breadcrumb-separator">/</span>
          <span class="breadcrumb-item pending">Confirm</span>
        </div>
        
        <div class="w-full bg-slate-700 h-1.5 rounded-full mb-6 overflow-hidden">
          <div class="bg-accent-orange h-full w-2/5 rounded-full"></div>
        </div>
        
        <div class="mb-6">
          <h1 class="text-white text-3xl md:text-4xl font-black leading-tight tracking-tight mb-3">Where should we come?</h1>
          <p class="text-slate-400 text-base">We serve all Colombo districts and suburbs.</p>
        </div>
        
        <div class="space-y-5">
          <div>
            <button onclick="getLocation()" class="location-btn">
              <i class="fas fa-location-arrow"></i>
              <span>Use My Current Location</span>
            </button>
            <div id="location-result" class="location-result">
              <p class="text-sm font-medium text-slate-300 mb-2">üìç Your Location:</p>
              <div id="location-output" class="text-sm"></div>
            </div>
          </div>
          
          <div class="relative">
            <div class="absolute inset-0 flex items-center">
              <div class="w-full border-t border-slate-700"></div>
            </div>
            <div class="relative flex justify-center text-sm">
              <span class="px-4 bg-primary text-slate-400">or enter manually</span>
            </div>
          </div>
          
          <div>
            <label class="text-slate-300 text-base font-semibold mb-2 block">
              Your address <span class="text-emergency">*</span>
            </label>
            <textarea id="manual-address" class="w-full p-4 border border-slate-700 rounded-xl bg-slate-800/50 focus:border-accent-orange focus:ring-0 text-base text-white" placeholder="House No, Street, City, Postal Code..." rows="3"></textarea>
            <p class="text-xs text-slate-400 mt-1">We'll dispatch the nearest technician</p>
          </div>
          
          <div>
            <p class="text-sm font-medium text-slate-300 mb-2">Popular Colombo areas:</p>
            <div class="flex flex-wrap gap-2">
              <button onclick="setArea('Colombo 01')" class="px-3 py-1.5 bg-slate-800 rounded-full text-xs font-semibold hover:bg-accent-orange hover:text-white transition-colors">Colombo 01</button>
              <button onclick="setArea('Colombo 03')" class="px-3 py-1.5 bg-slate-800 rounded-full text-xs font-semibold hover:bg-accent-orange hover:text-white transition-colors">Colombo 03</button>
              <button onclick="setArea('Colombo 07')" class="px-3 py-1.5 bg-slate-800 rounded-full text-xs font-semibold hover:bg-accent-orange hover:text-white transition-colors">Colombo 07</button>
              <button onclick="setArea('Rajagiriya')" class="px-3 py-1.5 bg-slate-800 rounded-full text-xs font-semibold hover:bg-accent-orange hover:text-white transition-colors">Rajagiriya</button>
              <button onclick="setArea('Nugegoda')" class="px-3 py-1.5 bg-slate-800 rounded-full text-xs font-semibold hover:bg-accent-orange hover:text-white transition-colors">Nugegoda</button>
              <button onclick="setArea('Dehiwala')" class="px-3 py-1.5 bg-slate-800 rounded-full text-xs font-semibold hover:bg-accent-orange hover:text-white transition-colors">Dehiwala</button>
            </div>
          </div>
          
          <div id="location-error" class="error-message hidden">
            <i class="fas fa-exclamation-circle"></i>
            <span>Please provide your location</span>
          </div>
        </div>
      </div>
      
      <div class="sticky-action-footer bg-primary-deep mt-6 -mx-4 px-4 py-4">
        <div class="flex flex-col gap-3">
          <button onclick="validateAndNext(3)" class="w-full bg-accent-orange hover:bg-accent-orange/90 text-white font-bold text-lg h-14 rounded-xl shadow-lg shadow-accent-orange/20 transition-all flex items-center justify-center gap-2">
            <span>Continue</span>
            <i class="fas fa-arrow-right"></i>
          </button>
          <button onclick="prevStep(3)" class="w-full text-slate-400 hover:text-white font-medium text-base py-2 transition-colors flex items-center justify-center gap-1">
            <i class="fas fa-arrow-left text-base"></i>
            Back
          </button>
        </div>
      </div>
    </div>

    <!-- STEP 4: Services -->
    <div id="step-4" class="step-hidden step-transition w-full max-w-2xl mx-auto">
      <div class="booking-card">
        <div class="breadcrumb">
          <span class="breadcrumb-item completed"><i class="fas fa-check-circle text-sm"></i> Welcome</span>
          <span class="breadcrumb-separator">/</span>
          <span class="breadcrumb-item completed"><i class="fas fa-check-circle text-sm"></i> Contact</span>
          <span class="breadcrumb-separator">/</span>
          <span class="breadcrumb-item completed"><i class="fas fa-check-circle text-sm"></i> Location</span>
          <span class="breadcrumb-separator">/</span>
          <span class="breadcrumb-item active"><i class="fas fa-circle text-sm"></i> Service</span>
          <span class="breadcrumb-separator">/</span>
          <span class="breadcrumb-item pending">Date/Time</span>
          <span class="breadcrumb-separator">/</span>
          <span class="breadcrumb-item pending">Confirm</span>
        </div>
        
        <div class="w-full bg-slate-700 h-1.5 rounded-full mb-6 overflow-hidden">
          <div class="bg-accent-orange h-full w-3/5 rounded-full"></div>
        </div>
        
        <div class="mb-6">
          <h1 class="text-white text-3xl font-black leading-tight tracking-tight mb-2">What electrical work is needed?</h1>
          <p class="text-slate-400 text-sm">All prices are per hour + parts (cost +15%)</p>
        </div>
        
        <div class="space-y-3 mb-6">
          <h3 class="text-sm font-bold text-white uppercase tracking-wider flex items-center gap-2">
            <i class="fas fa-exclamation-triangle text-accent-orange"></i> Emergency Electrical
          </h3>
          <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
            <label class="flex items-center justify-between p-4 rounded-xl border border-slate-700 bg-slate-800/30 hover:border-accent-orange/50 cursor-pointer">
              <div class="flex items-center gap-3">
                <input type="checkbox" class="service-checkbox custom-checkbox h-5 w-5 rounded border-slate-300 text-accent-orange focus:ring-accent-orange" data-price="3500" data-name="Power Outage Repair (per hour)" data-category="emergency">
                <div>
                  <p class="font-bold text-sm text-white">Power Outage Repair</p>
                  <p class="text-xs text-slate-400">Complete blackout, no power</p>
                </div>
              </div>
              <span class="font-bold text-accent-orange">LKR 3,500/hr</span>
            </label>
            
            <label class="flex items-center justify-between p-4 rounded-xl border border-slate-700 bg-slate-800/30 hover:border-accent-orange/50 cursor-pointer">
              <div class="flex items-center gap-3">
                <input type="checkbox" class="service-checkbox custom-checkbox h-5 w-5 rounded border-slate-300 text-accent-orange focus:ring-accent-orange" data-price="3500" data-name="Burning Smell / Sparks (per hour)" data-category="emergency">
                <div>
                  <p class="font-bold text-sm text-white">Burning Smell / Sparks</p>
                  <p class="text-xs text-slate-400">From outlets, switches, or panel</p>
                </div>
              </div>
              <span class="font-bold text-accent-orange">LKR 3,500/hr</span>
            </label>
            
            <label class="flex items-center justify-between p-4 rounded-xl border border-slate-700 bg-slate-800/30 hover:border-accent-orange/50 cursor-pointer">
              <div class="flex items-center gap-3">
                <input type="checkbox" class="service-checkbox custom-checkbox h-5 w-5 rounded border-slate-300 text-accent-orange focus:ring-accent-orange" data-price="3500" data-name="Circuit Breaker Tripping (per hour)" data-category="emergency">
                <div>
                  <p class="font-bold text-sm text-white">Breaker Tripping</p>
                  <p class="text-xs text-slate-400">MCB keeps switching off</p>
                </div>
              </div>
              <span class="font-bold text-accent-orange">LKR 3,500/hr</span>
            </label>
            
            <label class="flex items-center justify-between p-4 rounded-xl border border-slate-700 bg-slate-800/30 hover:border-accent-orange/50 cursor-pointer">
              <div class="flex items-center gap-3">
                <input type="checkbox" class="service-checkbox custom-checkbox h-5 w-5 rounded border-slate-300 text-accent-orange focus:ring-accent-orange" data-price="3500" data-name="Partial Power Loss (per hour)" data-category="emergency">
                <div>
                  <p class="font-bold text-sm text-white">Partial Power Loss</p>
                  <p class="text-xs text-slate-400">Some rooms working, some not</p>
                </div>
              </div>
              <span class="font-bold text-accent-orange">LKR 3,500/hr</span>
            </label>
          </div>
          
          <h3 class="text-sm font-bold text-white uppercase tracking-wider mt-4 flex items-center gap-2">
            <i class="fas fa-home"></i> Residential Services
          </h3>
          <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
            <label class="flex items-center justify-between p-4 rounded-xl border border-slate-700 bg-slate-800/30 hover:border-accent-orange/50 cursor-pointer">
              <div class="flex items-center gap-3">
                <input type="checkbox" class="service-checkbox custom-checkbox h-5 w-5 rounded border-slate-300 text-accent-orange focus:ring-accent-orange" data-price="2500" data-name="General Electrical Repair (per hour)" data-category="residential">
                <div>
                  <p class="font-bold text-sm text-white">General Repair</p>
                  <p class="text-xs text-slate-400">Faulty switches, outlets, lights</p>
                </div>
              </div>
              <span class="font-bold text-accent-orange">LKR 2,500/hr</span>
            </label>
            
            <label class="flex items-center justify-between p-4 rounded-xl border border-slate-700 bg-slate-800/30 hover:border-accent-orange/50 cursor-pointer">
              <div class="flex items-center gap-3">
                <input type="checkbox" class="service-checkbox custom-checkbox h-5 w-5 rounded border-slate-300 text-accent-orange focus:ring-accent-orange" data-price="2500" data-name="Lighting Installation (per hour)" data-category="residential">
                <div>
                  <p class="font-bold text-sm text-white">Lighting Installation</p>
                  <p class="text-xs text-slate-400">New lights, fans, fixtures</p>
                </div>
              </div>
              <span class="font-bold text-accent-orange">LKR 2,500/hr</span>
            </label>
            
            <label class="flex items-center justify-between p-4 rounded-xl border border-slate-700 bg-slate-800/30 hover:border-accent-orange/50 cursor-pointer">
              <div class="flex items-center gap-3">
                <input type="checkbox" class="service-checkbox custom-checkbox h-5 w-5 rounded border-slate-300 text-accent-orange focus:ring-accent-orange" data-price="0" data-name="Full House Rewiring" data-category="residential">
                <div>
                  <p class="font-bold text-sm text-white">Full House Rewiring</p>
                  <p class="text-xs text-slate-400">Complete rewiring project</p>
                </div>
              </div>
              <span class="font-bold text-accent-orange">Quote</span>
            </label>
          </div>
          
          <h3 class="text-sm font-bold text-white uppercase tracking-wider mt-4 flex items-center gap-2">
            <i class="fas fa-briefcase"></i> Commercial & Specialized
          </h3>
          <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
            <label class="flex items-center justify-between p-4 rounded-xl border border-slate-700 bg-slate-800/30 hover:border-accent-orange/50 cursor-pointer">
              <div class="flex items-center gap-3">
                <input type="checkbox" class="service-checkbox custom-checkbox h-5 w-5 rounded border-slate-300 text-accent-orange focus:ring-accent-orange" data-price="0" data-name="Commercial Electrical" data-category="commercial">
                <div>
                  <p class="font-bold text-sm text-white">Commercial Electrical</p>
                  <p class="text-xs text-slate-400">Offices, shops, restaurants</p>
                </div>
              </div>
              <span class="font-bold text-accent-orange">Quote</span>
            </label>
            
            <label class="flex items-center justify-between p-4 rounded-xl border border-slate-700 bg-slate-800/30 hover:border-accent-orange/50 cursor-pointer">
              <div class="flex items-center gap-3">
                <input type="checkbox" class="service-checkbox custom-checkbox h-5 w-5 rounded border-slate-300 text-accent-orange focus:ring-accent-orange" data-price="0" data-name="Solar Power Installation" data-category="specialized">
                <div>
                  <p class="font-bold text-sm text-white">Solar Power</p>
                  <p class="text-xs text-slate-400">PV panels, inverters, net metering</p>
                </div>
              </div>
              <span class="font-bold text-accent-orange">Quote</span>
            </label>
            
            <label class="flex items-center justify-between p-4 rounded-xl border border-slate-700 bg-slate-800/30 hover:border-accent-orange/50 cursor-pointer">
              <div class="flex items-center gap-3">
                <input type="checkbox" class="service-checkbox custom-checkbox h-5 w-5 rounded border-slate-300 text-accent-orange focus:ring-accent-orange" data-price="0" data-name="EV Charger Installation" data-category="specialized">
                <div>
                  <p class="font-bold text-sm text-white">EV Charger</p>
                  <p class="text-xs text-slate-400">Level 2 home or commercial</p>
                </div>
              </div>
              <span class="font-bold text-accent-orange">Quote</span>
            </label>
          </div>
        </div>
        
        <div class="mb-6 p-4 bg-primary/5 rounded-xl border border-primary/10">
          <div class="flex items-center gap-3">
            <i class="fas fa-tools text-primary"></i>
            <div>
              <h3 class="font-bold text-white">Parts & Materials</h3>
              <p class="text-xs text-slate-400">Parts cost +15% handling fee will be added to final bill</p>
            </div>
          </div>
          <input type="hidden" name="parts" value="premium" id="parts-value">
        </div>
        
        <div>
          <label class="text-slate-300 font-semibold mb-2 block">
            Describe the issue (optional)
          </label>
          <textarea id="problem-description" rows="2" class="w-full p-4 border border-slate-700 rounded-xl bg-slate-800/50 focus:border-accent-orange focus:ring-0 text-sm text-white" placeholder="E.g., 'Main switch tripping', 'Lights flickering when AC turns on'..."></textarea>
        </div>
        
        <div id="service-error" class="error-message hidden mt-4">
          <i class="fas fa-exclamation-circle"></i>
          <span>Please select at least one service</span>
        </div>
      </div>
      
      <div class="sticky-action-footer bg-primary-deep mt-6 -mx-4 px-4 py-4">
        <div class="flex items-center justify-between mb-3">
          <div class="flex flex-col">
            <span class="text-slate-400 text-xs font-bold uppercase tracking-wider">Selected</span>
            <p class="text-white font-black text-lg" id="selected-services">0 services</p>
          </div>
          <div class="flex flex-col items-end">
            <span class="text-slate-400 text-xs font-bold uppercase tracking-wider">Labor Estimate</span>
            <p class="text-white font-black text-lg" id="estimated-total">From LKR 0/hr</p>
          </div>
        </div>
        <div class="flex flex-col gap-3">
          <button onclick="validateAndNext(4)" class="w-full bg-accent-orange hover:bg-accent-orange/90 text-white font-bold text-lg h-14 rounded-xl shadow-lg shadow-accent-orange/20 transition-all flex items-center justify-center gap-2">
            <span>Continue</span>
            <i class="fas fa-arrow-right"></i>
          </button>
          <button onclick="prevStep(4)" class="w-full text-slate-400 hover:text-white font-medium text-base py-2 transition-colors flex items-center justify-center gap-1">
            <i class="fas fa-arrow-left text-base"></i>
            Back
          </button>
        </div>
      </div>
    </div>

    <!-- STEP 5: Date & Time -->
    <div id="step-5" class="step-hidden step-transition w-full max-w-[600px] mx-auto">
      <div class="booking-card">
        <div class="breadcrumb">
          <span class="breadcrumb-item completed"><i class="fas fa-check-circle text-sm"></i> Welcome</span>
          <span class="breadcrumb-separator">/</span>
          <span class="breadcrumb-item completed"><i class="fas fa-check-circle text-sm"></i> Contact</span>
          <span class="breadcrumb-separator">/</span>
          <span class="breadcrumb-item completed"><i class="fas fa-check-circle text-sm"></i> Location</span>
          <span class="breadcrumb-separator">/</span>
          <span class="breadcrumb-item completed"><i class="fas fa-check-circle text-sm"></i> Service</span>
          <span class="breadcrumb-separator">/</span>
          <span class="breadcrumb-item active"><i class="fas fa-circle text-sm"></i> Date/Time</span>
          <span class="breadcrumb-separator">/</span>
          <span class="breadcrumb-item pending">Confirm</span>
        </div>
        
        <div class="w-full bg-slate-700 h-1.5 rounded-full mb-6 overflow-hidden">
          <div class="bg-accent-orange h-full w-4/5 rounded-full"></div>
        </div>
        
        <div class="flex flex-col gap-2 mb-6">
          <h1 class="text-white text-3xl font-bold leading-tight tracking-tight">When should we come?</h1>
          <p class="text-slate-400 text-sm">24/7 emergency service available</p>
        </div>
        
        <div class="mb-6">
          <label class="text-slate-300 text-sm font-medium mb-2 block">Select date:</label>
          <input type="date" id="stock-date-picker" class="w-full p-4 border border-slate-700 rounded-xl bg-slate-800/50 focus:border-accent-orange focus:ring-0 text-white" min="">
          <div id="date-error" class="error-message hidden mt-2">
            <i class="fas fa-exclamation-circle"></i>
            <span>Please select a valid date</span>
          </div>
        </div>
        
        <div class="mb-6">
          <div class="flex items-center gap-2 mb-4">
            <i class="fas fa-clock text-accent-orange"></i>
            <h3 class="text-white font-bold">Select Time</h3>
          </div>
          
          <div class="flex items-center justify-between gap-3 mb-4">
            <button onclick="adjustTime(-15)" class="time-control-btn flex-1">
              <i class="fas fa-minus"></i>
              <span class="hidden sm:inline">15 min</span>
            </button>
            
            <div id="time-display-12hr" class="time-display-12hr flex-1">
              <span id="display-hour">12</span>
              <span>:</span>
              <span id="display-minute">00</span>
              <span id="display-ampm" class="ampm">PM</span>
            </div>
            
            <button onclick="adjustTime(15)" class="time-control-btn flex-1">
              <i class="fas fa-plus"></i>
              <span class="hidden sm:inline">15 min</span>
            </button>
          </div>
          
          <input type="hidden" id="time-24hr" value="">
          
          <div id="time-error" class="error-message hidden">
            <i class="fas fa-exclamation-circle"></i>
            <span id="time-error-text">Please select a valid time</span>
          </div>
        </div>
        
        <div class="mt-4 p-4 bg-emergency/5 rounded-xl border border-emergency/10">
          <div class="flex items-center gap-3">
            <i class="fas fa-bolt text-emergency"></i>
            <div>
              <p class="font-bold text-sm text-white">Need emergency service now?</p>
              <p class="text-xs text-slate-400">Call us immediately: <a href="tel:+94758244216" class="font-bold text-emergency">+94 75 824 4216</a></p>
            </div>
          </div>
        </div>
        
        <div class="mt-4 pt-4 border-t border-slate-700">
          <div class="flex items-center justify-between p-3 rounded-xl bg-slate-800/50">
            <div class="flex items-center gap-2">
              <i class="fas fa-calendar-alt text-accent-orange"></i>
              <span class="text-sm font-medium text-white">Selected:</span>
            </div>
            <span class="text-sm font-bold text-white" id="selected-datetime-display">Not selected</span>
          </div>
        </div>
      </div>
      
      <div class="sticky-action-footer bg-primary-deep mt-6 -mx-4 px-4 py-4">
        <div class="flex flex-col gap-3">
          <button onclick="validateAndNext(5)" class="w-full bg-accent-orange hover:bg-accent-orange/90 text-white font-bold text-lg h-14 rounded-xl shadow-lg shadow-accent-orange/20 transition-all flex items-center justify-center gap-2">
            <span>Review Booking</span>
            <i class="fas fa-arrow-right"></i>
          </button>
          <button onclick="prevStep(5)" class="w-full text-slate-400 hover:text-white font-medium text-base py-2 transition-colors flex items-center justify-center gap-1">
            <i class="fas fa-arrow-left text-base"></i>
            Back
          </button>
        </div>
      </div>
    </div>

    <!-- STEP 6: Review & Confirm -->
    <div id="step-6" class="step-hidden step-transition w-full max-w-[600px] mx-auto">
      <div class="booking-card">
        <div class="breadcrumb">
          <span class="breadcrumb-item completed"><i class="fas fa-check-circle text-sm"></i> Welcome</span>
          <span class="breadcrumb-separator">/</span>
          <span class="breadcrumb-item completed"><i class="fas fa-check-circle text-sm"></i> Contact</span>
          <span class="breadcrumb-separator">/</span>
          <span class="breadcrumb-item completed"><i class="fas fa-check-circle text-sm"></i> Location</span>
          <span class="breadcrumb-separator">/</span>
          <span class="breadcrumb-item completed"><i class="fas fa-check-circle text-sm"></i> Service</span>
          <span class="breadcrumb-separator">/</span>
          <span class="breadcrumb-item completed"><i class="fas fa-check-circle text-sm"></i> Date/Time</span>
          <span class="breadcrumb-separator">/</span>
          <span class="breadcrumb-item active"><i class="fas fa-circle text-sm"></i> Confirm</span>
        </div>
        
        <div class="w-full bg-slate-700 h-1.5 rounded-full mb-6 overflow-hidden">
          <div class="bg-accent-orange h-full w-full rounded-full"></div>
        </div>

        <div class="flex flex-col gap-2 mb-6">
          <h1 class="text-white text-3xl font-black leading-tight">Review your booking</h1>
          <p class="text-slate-400 text-sm">Please check all details before confirming</p>
        </div>

        <div class="bg-slate-800/50 rounded-xl p-4 mb-6">
          <div class="space-y-4" id="booking-summary-items"></div>
          
          <div class="mt-4 pt-4 border-t border-slate-700">
            <div class="flex justify-between font-bold">
              <span class="text-white">Labor Estimate</span>
              <span class="text-accent-orange text-xl" id="final-total">LKR 0/hr</span>
            </div>
            <p class="text-xs text-slate-400 mt-2">+ parts cost +15% handling fee ‚Ä¢ No call-out fee for emergencies</p>
          </div>
        </div>
        
        <div class="p-4 bg-primary/5 rounded-xl border border-primary/10 mb-4">
          <div class="flex items-center gap-2">
            <i class="fas fa-info-circle text-primary"></i>
            <p class="text-xs text-slate-300"><span class="font-bold">Parts:</span> Actual parts cost +15% handling fee will be added to final bill</p>
          </div>
        </div>
        
        <div class="p-4 bg-accent-orange/5 rounded-xl border border-accent-orange/10 flex gap-3 items-start mb-4">
          <div class="bg-accent-orange/10 p-2 rounded-lg text-accent-orange">
            <i class="fas fa-shield-alt"></i>
          </div>
          <div>
            <h4 class="font-bold text-sm text-white">By confirming you agree:</h4>
            <ul class="text-xs text-slate-400 list-disc ml-4 mt-1">
              <li>Licensed electrician will call before arrival</li>
              <li>Emergency jobs get 38-minute dispatch</li>
              <li>90-day workmanship guarantee</li>
            </ul>
          </div>
        </div>
        
        <div class="mb-4">
          <h3 class="font-bold mb-3 text-white">Payment method</h3>
          <div class="flex gap-3">
            <label class="flex-1 p-3 rounded-xl border-2 border-accent-orange/20 has-[:checked]:border-accent-orange has-[:checked]:bg-accent-orange/5 cursor-pointer text-center">
              <input type="radio" name="payment" value="cash" checked class="hidden">
              <i class="fas fa-money-bill-wave text-accent-orange"></i>
              <span class="block text-xs font-medium mt-1 text-white">Cash</span>
            </label>
            <label class="flex-1 p-3 rounded-xl border-2 border-accent-orange/20 has-[:checked]:border-accent-orange has-[:checked]:bg-accent-orange/5 cursor-pointer text-center">
              <input type="radio" name="payment" value="bank" class="hidden">
              <i class="fas fa-university text-accent-orange"></i>
              <span class="block text-xs font-medium mt-1 text-white">Bank Transfer*</span>
            </label>
          </div>
          <p class="text-xs text-slate-400 mt-2 text-center">*Online bank transfer via secure payment link</p>
        </div>
      </div>
      
      <div class="sticky-action-footer bg-primary-deep mt-6 -mx-4 px-4 py-4">
        <div class="flex flex-col gap-3">
          <button onclick="validateAndNext(6)" class="w-full bg-accent-orange hover:bg-accent-orange/90 text-white font-bold text-lg h-14 rounded-xl shadow-lg shadow-accent-orange/20 transition-all flex items-center justify-center gap-2">
            <span>Confirm Booking</span>
            <i class="fas fa-check-circle"></i>
          </button>
          <button onclick="prevStep(6)" class="w-full text-slate-400 hover:text-white font-medium text-base py-2 transition-colors flex items-center justify-center gap-1">
            <i class="fas fa-arrow-left text-base"></i>
            Back
          </button>
        </div>
      </div>
    </div>

    <!-- STEP 7: Confirmation -->
    <div id="step-7" class="step-hidden step-transition w-full max-w-[560px] mx-auto">
      <div class="booking-card">
        <div class="flex flex-col items-center pt-4 pb-6 text-center">
          <div class="mb-4 flex items-center justify-center size-20 rounded-full bg-green-500/10 text-green-500">
            <i class="fas fa-check-circle text-5xl"></i>
          </div>
          <h1 class="text-white text-3xl font-black leading-tight tracking-tight mb-2">
            Booking Confirmed!
          </h1>
          <p class="text-slate-400 text-sm max-w-sm">
            Your electrician will call within 30 minutes to confirm arrival time.
          </p>
        </div>

        <div class="px-4 py-4 bg-slate-800/50 rounded-xl mb-4">
          <h3 class="text-xs font-bold uppercase tracking-wider text-slate-400 mb-3">Appointment Summary</h3>
          <div class="space-y-3 text-sm" id="confirmation-details"></div>
        </div>

        <div class="p-4 bg-emergency/5 rounded-xl border border-emergency/10 mb-4">
          <div class="flex items-center gap-2">
            <i class="fas fa-bolt text-emergency"></i>
            <p class="text-xs text-slate-300">For immediate emergency: <a href="tel:+94758244216" class="font-bold text-emergency">+94 75 824 4216</a></p>
          </div>
        </div>

        <div class="flex flex-col gap-3">
          <button onclick="addToCalendar()" class="w-full bg-primary hover:bg-primary/90 text-white font-bold h-12 rounded-xl flex items-center justify-center gap-2 text-sm border border-slate-700">
            <i class="fas fa-calendar-plus"></i>
            Add to Calendar
          </button>
          <a href="https://wa.me/94758244216" class="w-full bg-whatsapp-green hover:bg-whatsapp-green/90 text-white font-bold h-12 rounded-xl flex items-center justify-center gap-2 text-sm">
            <i class="fab fa-whatsapp"></i>
            WhatsApp Us
          </a>
          <button onclick="resetToStep1()" class="mt-2 text-center text-accent-orange font-bold text-sm hover:underline flex items-center justify-center gap-1">
            <i class="fas fa-arrow-left text-base"></i>
            Book Another Service
          </button>
        </div>
      </div>
    </div>
  </main>

  <!-- Footer -->
  <footer class="bg-primary text-slate-300 mt-8 py-6 border-t border-slate-700">
    <div class="max-w-7xl mx-auto px-4 text-center text-xs">
      <p>¬© 2026 Six7 Electrical Sri Lanka. 24/7 Emergency: <a href="tel:+94758244216" class="text-accent-orange font-bold">+94 75 824 4216</a> ‚Ä¢ No Call-Out Fee</p>
    </div>
  </footer>

  <!-- Sticky Mobile CTA -->
  <div class="fixed bottom-0 left-0 right-0 z-50 p-3 bg-primary/95 backdrop-blur border-t border-slate-700 flex gap-3 md:hidden">
    <a href="tel:+94758244216" class="flex-1 bg-emergency text-white py-3.5 rounded-xl font-bold text-center flex items-center justify-center gap-2 shadow-lg"><i class="fas fa-phone-alt"></i> Call</a>
    <a href="https://wa.me/94758244216" class="flex-1 bg-whatsapp-green text-white py-3.5 rounded-xl font-bold text-center flex items-center justify-center gap-2 shadow-lg"><i class="fab fa-whatsapp"></i> WhatsApp</a>
  </div>

  <script>
    // State Management
    let currentStep = 1;
    const totalSteps = 7;
    let selectedServices = [];
    let selectedDate = null;
    let locationData = { coords: null, address: null };
    let currentHour = 12;
    let currentMinute = 0;
    let currentAmPm = 'PM';
    
    const FORM_SUBMIT_URL = 'https://formsubmit.co/ajax/electrical@six7.lk';
    
    // Mobile menu
    const menuBtn = document.getElementById('menuToggleBtn');
    const closeBtn = document.getElementById('closeDrawerBtn');
    const drawer = document.getElementById('mobile-menu-drawer');
    if (menuBtn && closeBtn && drawer) {
      menuBtn.addEventListener('click', () => drawer.classList.add('open'));
      closeBtn.addEventListener('click', () => drawer.classList.remove('open'));
      drawer.addEventListener('click', (e) => { if (e.target === drawer) drawer.classList.remove('open'); });
    }
    
    // Emergency Overlay Function
    function handleEmergencyCheck(checkbox) {
      if (checkbox.checked) {
        document.getElementById('emergencyOverlay').classList.add('active');
        setTimeout(() => {
          checkbox.checked = false;
        }, 500);
      }
    }
    
    function closeEmergencyOverlay(event, continueBooking = false) {
      if (event === true || (event.target && event.target.id === 'emergencyOverlay')) {
        document.getElementById('emergencyOverlay').classList.remove('active');
      }
    }
    
    function getSriLankaTime() {
      const now = new Date();
      const utc = now.getTime() + (now.getTimezoneOffset() * 60000);
      return new Date(utc + (5.5 * 60 * 60 * 1000));
    }
    
    document.addEventListener('DOMContentLoaded', function() {
      showStep(1);
      initializeServiceCheckboxes();
      
      const today = new Date().toISOString().split('T')[0];
      const datePicker = document.getElementById('stock-date-picker');
      if (datePicker) {
        datePicker.min = today;
        datePicker.value = today;
        handleStockDateChange(today);
      }
      
      initializeTimeToNextSlot();
      updateTimeDisplay();
    });
    
    function showStep(stepNumber) {
      for (let i = 1; i <= totalSteps; i++) {
        const step = document.getElementById(`step-${i}`);
        if (step) {
          step.classList.add('step-hidden');
          step.classList.remove('step-visible');
        }
      }
      
      const currentStepElement = document.getElementById(`step-${stepNumber}`);
      if (currentStepElement) {
        currentStepElement.classList.remove('step-hidden');
        currentStepElement.classList.add('step-visible');
      }
      
      currentStep = stepNumber;
      window.scrollTo({ top: 0, behavior: 'smooth' });
      
      if (stepNumber === 6) {
        updateBookingSummary();
      } else if (stepNumber === 7) {
        updateConfirmationDetails();
      }
    }
    
    function nextStep(currentStepNumber) {
      if (currentStepNumber < totalSteps) {
        showStep(currentStepNumber + 1);
      }
    }
    
    function prevStep(currentStepNumber) {
      if (currentStepNumber > 1) {
        showStep(currentStepNumber - 1);
      }
    }
    
    function resetToStep1() {
      showStep(1);
    }
    
    function validateAndNext(stepNumber) {
      let isValid = false;
      
      switch(stepNumber) {
        case 1:
          isValid = validateStep1();
          break;
        case 2:
          isValid = validateStep2();
          break;
        case 3:
          isValid = validateStep3();
          break;
        case 4:
          isValid = validateStep4();
          break;
        case 5:
          isValid = validateStep5();
          break;
        case 6:
          isValid = true;
          if (isValid) {
            submitBooking();
            return;
          }
          break;
      }
      
      if (isValid) {
        nextStep(stepNumber);
      }
    }
    
    function validateStep1() {
      const nameInput = document.getElementById('name-input');
      const nameError = document.getElementById('name-error');
      
      if (!nameInput || !nameInput.value.trim()) {
        if (nameError) nameError.classList.remove('hidden');
        if (nameInput) nameInput.classList.add('input-error');
        return false;
      }
      
      if (nameError) nameError.classList.add('hidden');
      if (nameInput) nameInput.classList.remove('input-error');
      return true;
    }
    
    function validateStep2() {
      const phoneInput = document.getElementById('phone-input');
      const phoneError = document.getElementById('phone-error');
      
      if (!phoneInput || !phoneInput.value.trim() || phoneInput.value.length < 10) {
        if (phoneError) phoneError.classList.remove('hidden');
        if (phoneInput) phoneInput.classList.add('input-error');
        return false;
      }
      
      if (phoneError) phoneError.classList.add('hidden');
      if (phoneInput) phoneInput.classList.remove('input-error');
      return true;
    }
    
    function validateStep3() {
      const manualAddress = document.getElementById('manual-address');
      const locationError = document.getElementById('location-error');
      
      if (!manualAddress || !manualAddress.value.trim()) {
        if (locationError) locationError.classList.remove('hidden');
        return false;
      }
      
      if (locationError) locationError.classList.add('hidden');
      locationData.address = manualAddress.value;
      return true;
    }
    
    function validateStep4() {
      const checkboxes = document.querySelectorAll('.service-checkbox:checked');
      const serviceError = document.getElementById('service-error');
      
      if (checkboxes.length === 0) {
        if (serviceError) serviceError.classList.remove('hidden');
        return false;
      }
      
      if (serviceError) serviceError.classList.add('hidden');
      
      selectedServices = Array.from(checkboxes).map(cb => ({
        name: cb.dataset.name,
        price: parseFloat(cb.dataset.price) || 0,
        category: cb.dataset.category
      }));
      
      return true;
    }
    
    function validateStep5() {
      const dateError = document.getElementById('date-error');
      const timeError = document.getElementById('time-error');
      const timeErrorText = document.getElementById('time-error-text');
      
      if (!selectedDate) {
        if (dateError) dateError.classList.remove('hidden');
        return false;
      }
      if (dateError) dateError.classList.add('hidden');
      
      const selectedDateTime = getSelectedDateTime();
      if (!selectedDateTime) {
        if (timeErrorText) timeErrorText.textContent = 'Please select a valid time';
        if (timeError) timeError.classList.remove('hidden');
        return false;
      }
      
      const sriLankaNow = getSriLankaTime();
      if (selectedDateTime < sriLankaNow) {
        if (timeErrorText) timeErrorText.textContent = 'Selected time is in the past';
        if (timeError) timeError.classList.remove('hidden');
        return false;
      }
      
      if (timeError) timeError.classList.add('hidden');
      
      const display = document.getElementById('selected-datetime-display');
      if (display) {
        display.textContent = `${selectedDate.toLocaleDateString('default', { weekday: 'short', month: 'short', day: 'numeric' })} at ${currentHour}:${currentMinute.toString().padStart(2, '0')} ${currentAmPm}`;
      }
      
      return true;
    }
    
    function initializeServiceCheckboxes() {
      const checkboxes = document.querySelectorAll('.service-checkbox');
      checkboxes.forEach(checkbox => {
        checkbox.addEventListener('change', updateServiceSummary);
      });
    }
    
    function updateServiceSummary() {
      const checkboxes = document.querySelectorAll('.service-checkbox:checked');
      const count = checkboxes.length;
      let total = 0;
      
      checkboxes.forEach(cb => {
        total += parseFloat(cb.dataset.price) || 0;
      });
      
      document.getElementById('selected-services').textContent = 
        count === 0 ? '0 services' : 
        count === 1 ? '1 service' : 
        `${count} services`;
      
      document.getElementById('estimated-total').textContent = 
        total > 0 ? `From LKR ${total.toLocaleString()}/hr` : 'Quote Required';
    }
    
    function getLocation() {
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(showPosition, showError);
      }
    }
    
    function showPosition(position) {
      const lat = position.coords.latitude;
      const lng = position.coords.longitude;
      const mapsLink = `https://www.google.com/maps?q=${lat},${lng}`;
      
      locationData.coords = `${lat},${lng}`;
      
      const output = document.getElementById("location-output");
      if (output) {
        output.innerHTML = `
          <p class="text-sm mb-2 text-slate-300">üìç Coordinates: ${lat.toFixed(6)}, ${lng.toFixed(6)}</p>
          <a href="${mapsLink}" target="_blank" class="location-link">
            <i class="fas fa-map-marker-alt text-sm"></i>
            View on Google Maps
          </a>
        `;
      }
      
      const result = document.getElementById('location-result');
      if (result) result.classList.add('visible');
    }
    
    function showError(error) {
      const output = document.getElementById("location-output");
      if (output) {
        output.innerHTML = `<p class="text-sm text-red-500">Please enter your address manually</p>`;
      }
      const result = document.getElementById('location-result');
      if (result) result.classList.add('visible');
    }
    
    function setArea(area) {
      const addressInput = document.getElementById('manual-address');
      if (addressInput) {
        addressInput.value = area;
      }
    }
    
    function handleStockDateChange(dateStr) {
      if (dateStr) {
        selectedDate = new Date(dateStr);
        selectedDate.setHours(0, 0, 0, 0);
      }
    }
    
    function initializeTimeToNextSlot() {
      const sriLankaNow = getSriLankaTime();
      let targetTime = new Date(sriLankaNow);
      targetTime.setMinutes(targetTime.getMinutes() + 30);
      
      let minutes = targetTime.getMinutes();
      minutes = Math.ceil(minutes / 15) * 15;
      if (minutes >= 60) {
        targetTime.setHours(targetTime.getHours() + 1);
        minutes = 0;
      }
      targetTime.setMinutes(minutes);
      
      let hours24 = targetTime.getHours();
      currentAmPm = hours24 >= 12 ? 'PM' : 'AM';
      currentHour = hours24 % 12;
      if (currentHour === 0) currentHour = 12;
      currentMinute = targetTime.getMinutes();
    }
    
    function adjustTime(minutesChange) {
      let hours24 = currentHour;
      if (currentAmPm === 'PM' && currentHour !== 12) hours24 += 12;
      if (currentAmPm === 'AM' && currentHour === 12) hours24 = 0;
      
      let totalMinutes = hours24 * 60 + currentMinute + minutesChange;
      
      if (totalMinutes < 0) totalMinutes += 24 * 60;
      if (totalMinutes >= 24 * 60) totalMinutes -= 24 * 60;
      
      hours24 = Math.floor(totalMinutes / 60);
      currentMinute = totalMinutes % 60;
      
      currentAmPm = hours24 >= 12 ? 'PM' : 'AM';
      currentHour = hours24 % 12;
      if (currentHour === 0) currentHour = 12;
      
      updateTimeDisplay();
    }
    
    function updateTimeDisplay() {
      const hourEl = document.getElementById('display-hour');
      const minuteEl = document.getElementById('display-minute');
      const ampmEl = document.getElementById('display-ampm');
      const time24El = document.getElementById('time-24hr');
      
      if (hourEl) hourEl.textContent = currentHour.toString().padStart(2, '0');
      if (minuteEl) minuteEl.textContent = currentMinute.toString().padStart(2, '0');
      if (ampmEl) ampmEl.textContent = currentAmPm;
      
      if (time24El) {
        let hours24 = currentHour;
        if (currentAmPm === 'PM' && currentHour !== 12) hours24 += 12;
        if (currentAmPm === 'AM' && currentHour === 12) hours24 = 0;
        time24El.value = `${hours24.toString().padStart(2, '0')}:${currentMinute.toString().padStart(2, '0')}`;
      }
    }
    
    function getSelectedDateTime() {
      if (!selectedDate) return null;
      
      const dateTime = new Date(selectedDate);
      let hours24 = currentHour;
      if (currentAmPm === 'PM' && currentHour !== 12) hours24 += 12;
      if (currentAmPm === 'AM' && currentHour === 12) hours24 = 0;
      
      dateTime.setHours(hours24, currentMinute, 0);
      return dateTime;
    }
    
    function updateBookingSummary() {
      const itemsContainer = document.getElementById('booking-summary-items');
      const finalTotal = document.getElementById('final-total');
      const name = document.getElementById('name-input')?.value || 'Guest';
      const phone = document.getElementById('phone-input')?.value || '';
      const address = document.getElementById('manual-address')?.value || 'Location provided';
      const problem = document.getElementById('problem-description')?.value || 'No description';
      
      let itemsHTML = `
        <div class="flex justify-between text-sm">
          <span class="text-slate-400">Name:</span>
          <span class="font-medium text-white">${name}</span>
        </div>
        <div class="flex justify-between text-sm">
          <span class="text-slate-400">Phone:</span>
          <span class="font-medium text-white">${phone}</span>
        </div>
        <div class="flex justify-between text-sm">
          <span class="text-slate-400">Location:</span>
          <span class="font-medium text-white text-right">${address.substring(0, 30)}${address.length > 30 ? '...' : ''}</span>
        </div>
      `;
      
      let subtotal = 0;
      selectedServices.forEach(service => {
        subtotal += service.price;
        itemsHTML += `
          <div class="flex justify-between text-sm border-t border-slate-700 pt-2">
            <span class="text-white">${service.name}</span>
            <span class="font-medium text-accent-orange">${service.price > 0 ? 'LKR ' + service.price.toLocaleString() + '/hr' : 'Quote'}</span>
          </div>
        `;
      });
      
      if (problem) {
        itemsHTML += `
          <div class="text-sm border-t border-slate-700 pt-2">
            <span class="text-slate-400">Issue:</span>
            <p class="mt-1 text-xs text-white">${problem}</p>
          </div>
        `;
      }
      
      if (itemsContainer) itemsContainer.innerHTML = itemsHTML;
      if (finalTotal) finalTotal.textContent = subtotal > 0 ? `LKR ${subtotal.toLocaleString()}/hr` : 'Quote Required';
    }
    
    function updateConfirmationDetails() {
      const details = document.getElementById('confirmation-details');
      const name = document.getElementById('name-input')?.value || 'Guest';
      const address = document.getElementById('manual-address')?.value || 'Location provided';
      
      if (details && selectedDate) {
        details.innerHTML = `
          <div class="flex justify-between">
            <span class="text-slate-400">Name:</span>
            <span class="font-bold text-white">${name}</span>
          </div>
          <div class="flex justify-between">
            <span class="text-slate-400">Date:</span>
            <span class="font-bold text-white">${selectedDate.toLocaleDateString()}</span>
          </div>
          <div class="flex justify-between">
            <span class="text-slate-400">Time:</span>
            <span class="font-bold text-white">${currentHour}:${currentMinute.toString().padStart(2, '0')} ${currentAmPm}</span>
          </div>
          <div class="flex justify-between">
            <span class="text-slate-400">Location:</span>
            <span class="font-bold text-white text-right">${address.substring(0, 20)}${address.length > 20 ? '...' : ''}</span>
          </div>
        `;
      }
    }
    
    async function submitBooking() {
      const name = document.getElementById('name-input')?.value || '';
      const phone = document.getElementById('phone-input')?.value || '';
      const email = document.getElementById('email-input')?.value || '';
      const address = document.getElementById('manual-address')?.value || '';
      const problem = document.getElementById('problem-description')?.value || '';
      const urgent = document.getElementById('urgent-check')?.checked || false;
      const payment = document.querySelector('input[name="payment"]:checked')?.value || 'cash';
      
      let paymentText = 'Cash on Arrival';
      if (payment === 'bank') paymentText = 'Online Bank Transfer';
      
      const services = selectedServices.map(s => s.name).join(', ');
      const subtotal = selectedServices.reduce((sum, s) => sum + s.price, 0);
      
      const formData = {
        _subject: `New Electrical Booking from ${name}`,
        name: name,
        phone: phone,
        email: email || 'Not provided',
        location: address,
        services: services,
        service_count: selectedServices.length,
        problem_description: problem || 'No description',
        urgent: urgent ? 'Yes - Emergency' : 'No',
        parts_policy: 'Parts cost +15% handling fee applies',
        date: selectedDate ? selectedDate.toLocaleDateString() : 'Not selected',
        time: `${currentHour}:${currentMinute.toString().padStart(2, '0')} ${currentAmPm}`,
        payment_method: paymentText,
        estimated_labor: subtotal > 0 ? `LKR ${subtotal.toLocaleString()}/hr` : 'Quote Required',
        _template: 'table',
        _captcha: 'false'
      };
      
      try {
        const response = await fetch(FORM_SUBMIT_URL, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(formData)
        });
        
        if (response.ok) {
          nextStep(6);
        } else {
          alert('Booking submitted! Your electrician will call shortly.');
          nextStep(6);
        }
      } catch (error) {
        alert('Booking received! Your electrician will call shortly.');
        nextStep(6);
      }
    }
    
    function addToCalendar() {
      const selectedDateTime = getSelectedDateTime();
      if (!selectedDateTime) return;
      
      const endDate = new Date(selectedDateTime);
      endDate.setHours(endDate.getHours() + 1);
      
      const formatDate = (date) => {
        return date.toISOString().replace(/-|:|\.\d+/g, '');
      };
      
      const icsContent = `BEGIN:VCALENDAR
VERSION:2.0
PRODID:-//Six7 Electrical//Booking//EN
BEGIN:VEVENT
UID:${new Date().getTime()}@six7.lk
DTSTAMP:${formatDate(new Date())}
DTSTART:${formatDate(selectedDateTime)}
DTEND:${formatDate(endDate)}
SUMMARY:Electrical Appointment with Six7
DESCRIPTION:Electrical service booking - Licensed Electrician
LOCATION:${locationData.address || 'Customer location'}
STATUS:CONFIRMED
BEGIN:VALARM
TRIGGER:-PT15M
ACTION:DISPLAY
DESCRIPTION:Reminder: Electrician arriving in 15 minutes
END:VALARM
END:VEVENT
END:VCALENDAR`;
      
      const blob = new Blob([icsContent], { type: 'text/calendar;charset=utf-8' });
      const link = document.createElement('a');
      link.href = URL.createObjectURL(blob);
      link.download = 'electrical-appointment.ics';
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    }
  </script>
</body>
</html>
