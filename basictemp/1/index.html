<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1.0, viewport-fit=cover" name="viewport"/>
    <title>White Label - Complete 6-Step Booking Flow</title>
    
    <!-- Fonts and Styles -->
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css2?family=Public+Sans:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap" rel="stylesheet"/>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    
    <style>
        /* Custom styles */
        .step-transition {
            transition: opacity 0.3s ease-in-out;
        }
        .step-hidden {
            display: none;
            opacity: 0;
        }
        .step-visible {
            display: block;
            opacity: 1;
        }
        .hide-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .hide-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        .custom-checkbox:checked {
            background-image: url("data:image/svg+xml,%3csvg viewBox='0 0 16 16' fill='white' xmlns='http://www.w3.org/2000/svg'%3e%3cpath d='M12.207 4.793a1 1 0 010 1.414l-5 5a1 1 0 01-1.414 0l-2-2a1 1 0 011.414-1.414L6.5 9.086l4.293-4.293a1 1 0 011.414 0z'/%3e%3c/svg%3e");
        }
        .safe-bottom {
            padding-bottom: env(safe-area-inset-bottom);
        }
        
        /* Sticky footer for action buttons */
        .sticky-action-footer {
            position: sticky;
            bottom: 0;
            z-index: 40;
            background: inherit;
            border-top: 1px solid rgba(146, 19, 236, 0.1);
            box-shadow: 0 -4px 6px -1px rgba(0, 0, 0, 0.05);
        }
        
        /* 12-hour time display styling */
        .time-display-12hr {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            background-color: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 0.75rem;
            padding: 0.75rem 1rem;
            font-size: 1.25rem;
            font-weight: 600;
        }
        
        .dark .time-display-12hr {
            background-color: #1e293b;
            border-color: #334155;
            color: #f1f5f9;
        }
        
        .time-display-12hr .ampm {
            font-size: 0.875rem;
            color: #64748b;
            font-weight: 500;
            margin-left: 0.25rem;
        }
        
        .dark .time-display-12hr .ampm {
            color: #94a3b8;
        }
        
        .time-control-btn {
            padding: 0.75rem;
            border-radius: 0.75rem;
            border: 1px solid #e2e8f0;
            background: white;
            color: #334155;
            font-weight: 500;
            transition: all 0.2s;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            min-width: 5rem;
        }
        
        .dark .time-control-btn {
            background-color: #1e293b;
            border-color: #334155;
            color: #cbd5e1;
        }
        
        .time-control-btn:hover {
            border-color: #9213ec;
            color: #9213ec;
        }
        
        .time-control-btn .material-symbols-outlined {
            font-size: 1.25rem;
        }
        
        /* Error message styling */
        .error-message {
            color: #ef4444;
            font-size: 0.75rem;
            margin-top: 0.25rem;
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }
        
        .error-message .material-symbols-outlined {
            font-size: 1rem;
        }
        
        .input-error {
            border-color: #ef4444 !important;
        }
        
        .input-error:focus {
            box-shadow: 0 0 0 2px rgba(239, 68, 68, 0.2) !important;
        }
        
        /* Date picker styling */
        input[type="date"] {
            width: 100%;
            padding: 0.75rem 1rem;
            background-color: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 0.75rem;
            font-size: 1rem;
            color: #0f172a;
        }
        
        .dark input[type="date"] {
            background-color: #1e293b;
            border-color: #334155;
            color: #f1f5f9;
        }
        
        input[type="date"]:focus {
            outline: none;
            border-color: #9213ec;
            box-shadow: 0 0 0 2px rgba(146, 19, 236, 0.2);
        }
        
        /* Breadcrumb styling - consistent across all steps */
        .breadcrumb {
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 2rem;
            padding: 0.5rem 0;
        }
        
        .breadcrumb-item {
            font-size: 0.875rem;
            font-weight: 500;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }
        
        .breadcrumb-item.completed {
            color: rgba(146, 19, 236, 0.8);
        }
        
        .breadcrumb-item.completed .material-symbols-outlined {
            font-size: 1rem;
            color: #9213ec;
        }
        
        .breadcrumb-item.active {
            color: #9213ec;
            font-weight: 700;
        }
        
        .breadcrumb-item.active .material-symbols-outlined {
            font-size: 1rem;
            color: #9213ec;
        }
        
        .breadcrumb-item.pending {
            color: #94a3b8;
        }
        
        .breadcrumb-separator {
            color: #cbd5e1;
            font-size: 0.875rem;
        }
        
        /* Card styling */
        .booking-card {
            background-color: white;
            border-radius: 1.5rem;
            padding: 1.5rem;
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.05);
            border: 1px solid rgba(146, 19, 236, 0.1);
        }
        
        @media (min-width: 768px) {
            .booking-card {
                padding: 2.5rem;
            }
        }
        
        .dark .booking-card {
            background-color: rgba(15, 23, 42, 0.5);
        }
    </style>
    
    <script>
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#9213ec",
                        "background-light": "#f7f6f8",
                        "background-dark": "#1a1022",
                    },
                    fontFamily: {
                        "display": ["Plus Jakarta Sans", "Public Sans", "sans-serif"]
                    },
                    borderRadius: {
                        "DEFAULT": "1rem",
                        "lg": "2rem",
                        "xl": "3rem",
                        "2xl": "1rem",
                        "3xl": "1.5rem",
                        "full": "9999px"
                    },
                },
            },
        }
    </script>
</head>
<body class="bg-background-light dark:bg-background-dark font-display text-slate-900 dark:text-slate-100 min-h-screen flex flex-col">
    <div class="layout-container flex h-full grow flex-col">
        <!-- Unified Header -->
        <header class="flex items-center justify-between whitespace-nowrap border-b border-solid border-primary/10 bg-white dark:bg-background-dark px-6 md:px-40 py-3">
            <div class="flex items-center gap-4 text-slate-900 dark:text-slate-100">
                <div class="size-8 flex items-center justify-center bg-primary rounded-lg text-white">
                    <span class="material-symbols-outlined">auto_awesome</span>
                </div>
                <h2 class="text-slate-900 dark:text-slate-100 text-lg font-bold leading-tight tracking-[-0.015em]">White Label</h2>
            </div>
            <div class="flex flex-1 justify-end gap-8 items-center">
                <div class="hidden md:flex items-center gap-9">
                    <a class="text-slate-600 dark:text-slate-400 text-sm font-medium leading-normal hover:text-primary transition-colors" href="#">Services</a>
                    <a class="text-slate-600 dark:text-slate-400 text-sm font-medium leading-normal hover:text-primary transition-colors" href="#">About</a>
                    <a class="text-slate-600 dark:text-slate-400 text-sm font-medium leading-normal hover:text-primary transition-colors" href="#">Contact</a>
                </div>
                <div class="bg-center bg-no-repeat aspect-square bg-cover rounded-full size-10 border-2 border-primary/20" data-alt="User profile picture placeholder" style='background-image: url("https://lh3.googleusercontent.com/aida-public/AB6AXuCQJQjVLNQPCmDfeGgD1fnQeDhyVkweFj0iZskyukn8aVN_4QI-nVzxun7Vvmhw80Pfu0URKsBts9hrfWnLqmJyQVcc0PpN-sdQ3fkjDGzGXgNBq4oHr4NHDFf3v4EYXhuT3pLBt8CuB6fOfkEFoXLmbbr4cwv0KFOwQV7UFdbfJ3EVQmYRb0rnmgiGs-XJJa5wGhT4iiy3GPgYcFCNddt8nV5bMZFKEV4XoEWLsztfoFP7ZxKxKZukA7BY0v9dHNoaO4gWKcUM-H5m");'></div>
            </div>
        </header>

        <!-- Main Content with All Steps -->
        <main class="flex-1 flex items-start justify-center py-8 px-4 md:px-0">
            <!-- STEP 1: Welcome Screen -->
            <div id="step-1" class="step-visible step-transition w-full max-w-[560px] mx-auto">
                <div class="booking-card flex flex-col items-center text-center">
                    <div class="mb-8 p-4 rounded-full bg-primary/10">
                        <span class="material-symbols-outlined text-primary text-4xl">face_6</span>
                    </div>
                    <div class="space-y-3 mb-10">
                        <h1 class="text-slate-900 dark:text-slate-100 text-4xl md:text-5xl font-extrabold tracking-tight">
                            Welcome to <span class="text-primary">White Label</span>
                        </h1>
                        <p class="text-slate-500 dark:text-slate-400 text-lg">
                            Let's get started by getting to know you.
                        </p>
                    </div>
                    <div class="w-full space-y-6">
                        <div class="flex flex-col items-start w-full">
                            <label class="text-slate-700 dark:text-slate-300 text-base font-semibold mb-3 ml-1" for="name-input">
                                What is your name? <span class="text-red-500">*</span>
                            </label>
                            <div class="relative w-full">
                                <span class="material-symbols-outlined absolute left-4 top-1/2 -translate-y-1/2 text-slate-400">person</span>
                                <input class="w-full pl-12 pr-4 py-4 rounded-xl border-2 border-slate-100 dark:border-slate-800 bg-slate-50 dark:bg-slate-800/50 focus:border-primary focus:ring-0 transition-all text-lg placeholder:text-slate-400" id="name-input" placeholder="Enter your full name" type="text"/>
                            </div>
                            <div id="name-error" class="error-message hidden">
                                <span class="material-symbols-outlined">error</span>
                                <span>Please enter your name</span>
                            </div>
                        </div>
                        <div class="pt-4">
                            <button onclick="validateAndNext(1)" class="w-full py-4 px-8 rounded-full bg-primary text-white text-lg font-bold shadow-xl shadow-primary/30 hover:shadow-primary/40 active:scale-[0.98] transition-all flex items-center justify-center gap-2 group">
                                <span>Continue</span>
                                <span class="material-symbols-outlined group-hover:translate-x-1 transition-transform">arrow_forward</span>
                            </button>
                        </div>
                    </div>
                    <div class="mt-12 flex items-center gap-4">
                        <div class="flex -space-x-3 overflow-hidden">
                            <img class="inline-block h-8 w-8 rounded-full ring-2 ring-white dark:ring-slate-900" src="https://lh3.googleusercontent.com/aida-public/AB6AXuD67YB0V50ZCNoM23W1ouDqpG-bxOjcTuSzGmGnNCuEQWPonuQYMpbJTil7Wyn_jCnqYJLcOiY2BYGXqC6k_oaOrPs9hdxLWwkf-75ECDlnVnfH9V6BiRahh6EyTjIAKnC66_w9oVUAktb1hPkkPXa0UHgdFb16EHc37yNxa2_M62mUUgbg-mce6PyDmb3127BUk25eEnD21YNp2sku9vgnQNUtbXiDnIWT-xAIPOAeSZbYss0e4EQQMlTbkwXJ2V8Q0elL8wyjj3MM" alt="User"/>
                            <img class="inline-block h-8 w-8 rounded-full ring-2 ring-white dark:ring-slate-900" src="https://lh3.googleusercontent.com/aida-public/AB6AXuCg8Z_VHTy6Vs4q7fVfnt1Q9-aNDZbkiDb8t5si9QQL8P6iJk-HHrs7mzlk2scqNvtGol0lzgc8wS-erEzuOaigqJ-Q7fqMXiGjKD3HwjLrVXHAW5oBGKfCq90ULmfAF_2v5zBH6BKOtNIkuA_rtiv9pqk-DvQqevLr1MNzlPZZOMmYNItCA2jwY_jACBuB7o2a0IsJPUpt6LYIbxXdN9J5l0356GP0K010jk-O9XRheRGN0YKy43nlYSeOuf5QMbDb0nABOLY6n20n" alt="User"/>
                            <img class="inline-block h-8 w-8 rounded-full ring-2 ring-white dark:ring-slate-900" src="https://lh3.googleusercontent.com/aida-public/AB6AXuALegrgeWEG5qCIih2D6ZbdadyU8DWJXnQ5Ra2KJe_mgJmuvGG2jaakEgPLHUtUmf6NqPozTA5xtC28XDRy10inddGYMXiY3NoEICWJXhsFLf6qwxG8dbuFaDETCc0CKG6wNT5Dwh030467PYogsUaWIiLL4JLIsq-OvY_x_WD1LD582PvT7CflosUM72ccfYqvQ-tRBoNHml0Nl5X6SPpZmuHQyRKQHLgDN6x0HsU3JCJRNcb3AT4DBxGzT6gZj8TGvHfEeKDkWKS4" alt="User"/>
                        </div>
                        <p class="text-sm text-slate-500 dark:text-slate-400">
                            Join <span class="font-bold text-slate-700 dark:text-slate-200">2,000+</span> happy clients
                        </p>
                    </div>
                </div>
            </div>

            <!-- STEP 2: Contact Information -->
            <div id="step-2" class="step-hidden step-transition w-full max-w-[640px] mx-auto">
                <div class="booking-card">
                    <!-- Breadcrumbs - consistent style -->
                    <div class="breadcrumb">
                        <span class="breadcrumb-item completed">
                            <span class="material-symbols-outlined text-sm">check_circle</span> Welcome
                        </span>
                        <span class="breadcrumb-separator">/</span>
                        <span class="breadcrumb-item active">
                            <span class="material-symbols-outlined text-sm">radio_button_checked</span> Contact
                        </span>
                        <span class="breadcrumb-separator">/</span>
                        <span class="breadcrumb-item pending">Services</span>
                        <span class="breadcrumb-separator">/</span>
                        <span class="breadcrumb-item pending">Date/Time</span>
                        <span class="breadcrumb-separator">/</span>
                        <span class="breadcrumb-item pending">Payment</span>
                    </div>
                    
                    <!-- Progress Bar -->
                    <div class="w-full bg-slate-200 dark:bg-slate-700 h-1.5 rounded-full mb-8 overflow-hidden">
                        <div class="bg-primary h-full w-1/4 rounded-full"></div>
                    </div>
                    
                    <!-- Hero Section -->
                    <div class="mb-8">
                        <h1 class="text-slate-900 dark:text-slate-100 text-3xl md:text-4xl font-black leading-tight tracking-tight mb-4">How can we reach you?</h1>
                        <p class="text-slate-600 dark:text-slate-400 text-lg">Please provide your contact details so we can confirm your booking.</p>
                    </div>
                    
                    <!-- Form Card -->
                    <div class="space-y-6">
                        <!-- Phone Number Input -->
                        <div class="flex flex-col gap-2">
                            <label class="flex flex-col">
                                <span class="text-slate-900 dark:text-slate-100 text-base font-semibold mb-2 flex items-center gap-1">
                                    Phone Number <span class="text-red-500">*</span>
                                </span>
                                <div class="relative">
                                    <span class="absolute left-4 top-1/2 -translate-y-1/2 material-symbols-outlined text-slate-400">call</span>
                                    <input class="form-input w-full rounded-lg border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 focus:border-primary focus:ring-2 focus:ring-primary/20 h-14 pl-12 pr-4 text-base" type="tel" id="phone-input" placeholder="+94 77 123 4567"/>
                                </div>
                                <div id="phone-error" class="error-message hidden">
                                    <span class="material-symbols-outlined">error</span>
                                    <span>Please enter a valid phone number</span>
                                </div>
                                <p class="text-slate-400 text-xs mt-1.5">Required for SMS booking updates</p>
                            </label>
                        </div>
                        
                        <!-- Email Address Input -->
                        <div class="flex flex-col gap-2">
                            <label class="flex flex-col">
                                <div class="flex justify-between items-center mb-2">
                                    <span class="text-slate-900 dark:text-slate-100 text-base font-semibold">Email Address</span>
                                    <span class="text-slate-400 text-xs font-normal italic">(Optional)</span>
                                </div>
                                <div class="relative">
                                    <span class="absolute left-4 top-1/2 -translate-y-1/2 material-symbols-outlined text-slate-400">mail</span>
                                    <input class="form-input w-full rounded-lg border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 focus:border-primary focus:ring-2 focus:ring-primary/20 h-14 pl-12 pr-4 text-base" type="email" id="email-input" placeholder="your@email.com"/>
                                </div>
                                <div id="email-error" class="error-message hidden">
                                    <span class="material-symbols-outlined">error</span>
                                    <span>Please enter a valid email address</span>
                                </div>
                            </label>
                        </div>
                    </div>
                    
                    <!-- Privacy Notice -->
                    <div class="mt-8 p-4 bg-primary/5 rounded-xl border border-primary/10 flex gap-4 items-start">
                        <div class="bg-primary/10 p-2 rounded-lg text-primary">
                            <span class="material-symbols-outlined">security</span>
                        </div>
                        <div>
                            <h4 class="text-slate-900 dark:text-slate-100 font-bold text-sm">Your privacy matters</h4>
                            <p class="text-slate-600 dark:text-slate-400 text-xs">We never share your information with third parties.</p>
                        </div>
                    </div>
                </div>
                
                <!-- Sticky Action Footer -->
                <div class="sticky-action-footer bg-white dark:bg-slate-900 mt-8 -mx-4 md:-mx-6 px-4 md:px-6 py-4">
                    <div class="flex flex-col gap-3">
                        <button onclick="validateAndNext(2)" class="w-full bg-primary hover:bg-primary/90 text-white font-bold text-lg h-16 rounded-xl shadow-lg shadow-primary/20 transition-all flex items-center justify-center gap-2">
                            <span>Continue to Services</span>
                            <span class="material-symbols-outlined">arrow_forward</span>
                        </button>
                        <button onclick="prevStep(2)" class="w-full text-slate-400 hover:text-slate-600 dark:hover:text-slate-200 font-medium text-base py-2 transition-colors flex items-center justify-center gap-1">
                            <span class="material-symbols-outlined text-base">arrow_back</span>
                            Back
                        </button>
                    </div>
                </div>
            </div>

            <!-- STEP 3: Service Selection -->
            <div id="step-3" class="step-hidden step-transition w-full max-w-2xl mx-auto">
                <div class="booking-card">
                    <!-- Breadcrumbs - consistent style -->
                    <div class="breadcrumb">
                        <span class="breadcrumb-item completed">
                            <span class="material-symbols-outlined text-sm">check_circle</span> Welcome
                        </span>
                        <span class="breadcrumb-separator">/</span>
                        <span class="breadcrumb-item completed">
                            <span class="material-symbols-outlined text-sm">check_circle</span> Contact
                        </span>
                        <span class="breadcrumb-separator">/</span>
                        <span class="breadcrumb-item active">
                            <span class="material-symbols-outlined text-sm">radio_button_checked</span> Services
                        </span>
                        <span class="breadcrumb-separator">/</span>
                        <span class="breadcrumb-item pending">Date/Time</span>
                        <span class="breadcrumb-separator">/</span>
                        <span class="breadcrumb-item pending">Payment</span>
                    </div>
                    
                    <!-- Progress Bar -->
                    <div class="w-full bg-slate-200 dark:bg-slate-700 h-1.5 rounded-full mb-8 overflow-hidden">
                        <div class="bg-primary h-full w-1/2 rounded-full"></div>
                    </div>
                    
                    <!-- Headline -->
                    <div class="mb-8">
                        <h1 class="text-slate-900 dark:text-slate-100 text-3xl font-black leading-tight tracking-tight mb-2">Select Services</h1>
                        <p class="text-slate-500 dark:text-slate-400 text-base">Choose one or more services for your appointment</p>
                    </div>
                    
                    <!-- Service List -->
                    <div class="space-y-3">
                        <label class="group flex items-center justify-between p-4 rounded-xl border border-slate-200 dark:border-slate-800 bg-slate-50/50 dark:bg-slate-800/30 hover:border-primary/50 hover:bg-primary/5 cursor-pointer transition-all">
                            <div class="flex items-center gap-4">
                                <input class="service-checkbox custom-checkbox h-6 w-6 rounded border-slate-300 dark:border-slate-700 bg-transparent text-primary focus:ring-primary focus:ring-offset-0" type="checkbox" data-price="8500" data-name="Service A"/>
                                <div>
                                    <p class="text-slate-900 dark:text-slate-100 text-base font-semibold">Service A</p>
                                    <p class="text-slate-500 dark:text-slate-400 text-sm">Professional standard treatment</p>
                                </div>
                            </div>
                            <span class="text-slate-900 dark:text-slate-100 font-bold">LKR 8,500</span>
                        </label>
                        
                        <label class="group flex items-center justify-between p-4 rounded-xl border border-slate-200 dark:border-slate-800 bg-slate-50/50 dark:bg-slate-800/30 hover:border-primary/50 hover:bg-primary/5 cursor-pointer transition-all">
                            <div class="flex items-center gap-4">
                                <input class="service-checkbox custom-checkbox h-6 w-6 rounded border-slate-300 dark:border-slate-700 bg-transparent text-primary focus:ring-primary focus:ring-offset-0" type="checkbox" data-price="12000" data-name="Service B"/>
                                <div>
                                    <p class="text-slate-900 dark:text-slate-100 text-base font-semibold">Service B</p>
                                    <p class="text-slate-500 dark:text-slate-400 text-sm">Advanced specialized care</p>
                                </div>
                            </div>
                            <span class="text-slate-900 dark:text-slate-100 font-bold">LKR 12,000</span>
                        </label>
                        
                        <label class="group flex items-center justify-between p-4 rounded-xl border border-slate-200 dark:border-slate-800 bg-slate-50/50 dark:bg-slate-800/30 hover:border-primary/50 hover:bg-primary/5 cursor-pointer transition-all">
                            <div class="flex items-center gap-4">
                                <input class="service-checkbox custom-checkbox h-6 w-6 rounded border-slate-300 dark:border-slate-700 bg-transparent text-primary focus:ring-primary focus:ring-offset-0" type="checkbox" data-price="19500" data-name="Service C"/>
                                <div>
                                    <p class="text-slate-900 dark:text-slate-100 text-base font-semibold">Service C</p>
                                    <p class="text-slate-500 dark:text-slate-400 text-sm">Premium full-service package</p>
                                </div>
                            </div>
                            <span class="text-slate-900 dark:text-slate-100 font-bold">LKR 19,500</span>
                        </label>
                    </div>
                    
                    <!-- Custom Service Section -->
                    <div class="mt-6 border-t border-dashed border-slate-200 dark:border-slate-800 pt-6">
                        <button onclick="toggleCustomService()" class="flex items-center gap-2 px-4 py-2 rounded-lg text-primary hover:bg-primary/10 font-bold text-sm transition-colors group">
                            <span class="material-symbols-outlined text-xl group-hover:scale-110 transition-transform" id="custom-service-icon">add_circle</span>
                            <span id="custom-service-text">Add Custom Service</span>
                        </button>
                        <div class="mt-4 px-2 hidden" id="custom-service-container">
                            <div class="flex gap-2">
                                <input class="flex-1 px-4 py-3 rounded-xl border-slate-200 dark:border-slate-800 dark:bg-slate-900/50 focus:border-primary focus:ring-primary text-slate-900 dark:text-slate-100" id="custom-service-input" placeholder="Describe your custom service..." type="text"/>
                                <button onclick="addCustomService()" class="px-6 h-[52px] bg-primary hover:bg-primary/90 text-white font-bold rounded-xl">
                                    <span class="material-symbols-outlined">add</span>
                                </button>
                            </div>
                            <p class="text-xs text-slate-400 mt-2">Custom services will be billed at provider's rate</p>
                        </div>
                        
                        <!-- Custom Services List -->
                        <div id="custom-services-list" class="mt-4 space-y-2"></div>
                        
                        <!-- Service Selection Error -->
                        <div id="service-error" class="error-message hidden mt-4">
                            <span class="material-symbols-outlined">error</span>
                            <span>Please select at least one service</span>
                        </div>
                    </div>
                </div>
                
                <!-- Sticky Action Footer -->
                <div class="sticky-action-footer bg-white dark:bg-slate-900 mt-8 -mx-4 md:-mx-6 px-4 md:px-6 py-4">
                    <div class="flex items-center justify-between mb-3">
                        <div class="flex flex-col">
                            <span class="text-slate-500 dark:text-slate-400 text-xs font-bold uppercase tracking-wider">Selected</span>
                            <p class="text-slate-900 dark:text-slate-100 font-black text-lg" id="selected-services">0 services</p>
                        </div>
                        <div class="flex flex-col items-end">
                            <span class="text-slate-500 dark:text-slate-400 text-xs font-bold uppercase tracking-wider">Total</span>
                            <p class="text-slate-900 dark:text-slate-100 font-black text-lg" id="estimated-total">LKR 0</p>
                        </div>
                    </div>
                    <div class="flex flex-col gap-3">
                        <button onclick="validateAndNext(3)" class="w-full bg-primary hover:bg-primary/90 text-white font-bold text-lg h-16 rounded-xl shadow-lg shadow-primary/20 transition-all flex items-center justify-center gap-2">
                            <span>Continue</span>
                            <span class="material-symbols-outlined">arrow_forward</span>
                        </button>
                        <button onclick="prevStep(3)" class="w-full text-slate-400 hover:text-slate-600 dark:hover:text-slate-200 font-medium text-base py-2 transition-colors flex items-center justify-center gap-1">
                            <span class="material-symbols-outlined text-base">arrow_back</span>
                            Back to Contact
                        </button>
                    </div>
                </div>
            </div>

            <!-- STEP 4: Date & Time Selection - Updated with stock date picker and 12-hour time control -->
            <div id="step-4" class="step-hidden step-transition w-full max-w-[600px] mx-auto">
                <div class="booking-card">
                    <!-- Breadcrumbs - consistent style -->
                    <div class="breadcrumb">
                        <span class="breadcrumb-item completed">
                            <span class="material-symbols-outlined text-sm">check_circle</span> Welcome
                        </span>
                        <span class="breadcrumb-separator">/</span>
                        <span class="breadcrumb-item completed">
                            <span class="material-symbols-outlined text-sm">check_circle</span> Contact
                        </span>
                        <span class="breadcrumb-separator">/</span>
                        <span class="breadcrumb-item completed">
                            <span class="material-symbols-outlined text-sm">check_circle</span> Services
                        </span>
                        <span class="breadcrumb-separator">/</span>
                        <span class="breadcrumb-item active">
                            <span class="material-symbols-outlined text-sm">radio_button_checked</span> Date/Time
                        </span>
                        <span class="breadcrumb-separator">/</span>
                        <span class="breadcrumb-item pending">Payment</span>
                    </div>
                    
                    <!-- Progress Bar -->
                    <div class="w-full bg-slate-200 dark:bg-slate-700 h-1.5 rounded-full mb-8 overflow-hidden">
                        <div class="bg-primary h-full w-3/4 rounded-full"></div>
                    </div>
                    
                    <!-- Headline -->
                    <div class="flex flex-col gap-2 mb-8">
                        <h1 class="text-slate-900 dark:text-slate-100 text-3xl font-bold leading-tight tracking-tight">Choose a Date & Time</h1>
                        <p class="text-slate-500 dark:text-slate-400 text-base">Select your preferred slot for the appointment (Sri Lanka Time - GMT+5:30). Bookings must be at least 30 minutes from now.</p>
                    </div>
                    
                    <!-- Stock HTML5 Date Picker with min date set to today -->
                    <div class="mb-8">
                        <label class="text-slate-700 dark:text-slate-300 text-sm font-medium mb-2 block">Select date:</label>
                        <input type="date" id="stock-date-picker" class="w-full" onchange="handleStockDateChange(this.value)" min="">
                        <div id="date-error" class="error-message hidden mt-2">
                            <span class="material-symbols-outlined">error</span>
                            <span>Please select a valid date</span>
                        </div>
                    </div>
                    
                    <!-- 12-hour Time Selection with +/- 15 minute buttons -->
                    <div class="mb-12">
                        <div class="flex items-center gap-2 mb-6">
                            <span class="material-symbols-outlined text-primary">schedule</span>
                            <h3 class="text-slate-900 dark:text-slate-100 text-lg font-bold">Select Time (12-hour)</h3>
                        </div>
                        
                        <!-- 12-hour time display with AM/PM -->
                        <div class="flex items-center justify-between gap-3 mb-4">
                            <button onclick="adjustTime(-15)" class="time-control-btn flex-1">
                                <span class="material-symbols-outlined">remove</span>
                                <span>15 min</span>
                            </button>
                            
                            <div id="time-display-12hr" class="time-display-12hr flex-1">
                                <span id="display-hour">12</span>
                                <span>:</span>
                                <span id="display-minute">00</span>
                                <span id="display-ampm" class="ampm">PM</span>
                            </div>
                            
                            <button onclick="adjustTime(15)" class="time-control-btn flex-1">
                                <span class="material-symbols-outlined">add</span>
                                <span>15 min</span>
                            </button>
                        </div>
                        
                        <!-- Hidden time input for form submission (24-hour format) -->
                        <input type="hidden" id="time-24hr" value="">
                        
                        <div id="time-error" class="error-message hidden">
                            <span class="material-symbols-outlined">error</span>
                            <span id="time-error-text">Please select a valid time</span>
                        </div>
                    </div>
                    
                    <!-- Selected Slot Display -->
                    <div class="mt-auto pt-6 border-t border-slate-100 dark:border-slate-800">
                        <div class="flex items-center justify-between mb-6 p-4 rounded-2xl bg-background-light dark:bg-slate-800/50">
                            <div class="flex items-center gap-3">
                                <div class="size-10 rounded-full bg-primary/20 flex items-center justify-center text-primary">
                                    <span class="material-symbols-outlined">event</span>
                                </div>
                                <div class="flex flex-col">
                                    <span class="text-xs text-slate-500 dark:text-slate-400 uppercase font-bold tracking-wider">Selected Slot</span>
                                    <span class="text-sm font-bold text-slate-900 dark:text-slate-100" id="selected-datetime-display">Not selected</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Sticky Action Footer -->
                <div class="sticky-action-footer bg-white dark:bg-slate-900 mt-8 -mx-4 md:-mx-6 px-4 md:px-6 py-4">
                    <div class="flex flex-col gap-3">
                        <button onclick="validateAndNext(4)" class="w-full bg-primary hover:bg-primary/90 text-white font-bold text-lg h-16 rounded-xl shadow-lg shadow-primary/20 transition-all flex items-center justify-center gap-2">
                            <span>Proceed to Payment</span>
                            <span class="material-symbols-outlined">arrow_forward</span>
                        </button>
                        <button onclick="prevStep(4)" class="w-full text-slate-400 hover:text-slate-600 dark:hover:text-slate-200 font-medium text-base py-2 transition-colors flex items-center justify-center gap-1">
                            <span class="material-symbols-outlined text-base">arrow_back</span>
                            Back to Services
                        </button>
                    </div>
                </div>
            </div>

            <!-- STEP 5: Payment & Summary -->
            <div id="step-5" class="step-hidden step-transition w-full max-w-[960px] mx-auto">
                <div class="booking-card">
                    <!-- Breadcrumbs - consistent style -->
                    <div class="breadcrumb">
                        <span class="breadcrumb-item completed">
                            <span class="material-symbols-outlined text-sm">check_circle</span> Welcome
                        </span>
                        <span class="breadcrumb-separator">/</span>
                        <span class="breadcrumb-item completed">
                            <span class="material-symbols-outlined text-sm">check_circle</span> Contact
                        </span>
                        <span class="breadcrumb-separator">/</span>
                        <span class="breadcrumb-item completed">
                            <span class="material-symbols-outlined text-sm">check_circle</span> Services
                        </span>
                        <span class="breadcrumb-separator">/</span>
                        <span class="breadcrumb-item completed">
                            <span class="material-symbols-outlined text-sm">check_circle</span> Date/Time
                        </span>
                        <span class="breadcrumb-separator">/</span>
                        <span class="breadcrumb-item active">
                            <span class="material-symbols-outlined text-sm">radio_button_checked</span> Payment
                        </span>
                    </div>
                    
                    <!-- Progress Bar -->
                    <div class="w-full bg-slate-200 dark:bg-slate-700 h-1.5 rounded-full mb-8 overflow-hidden">
                        <div class="bg-primary h-full w-full rounded-full"></div>
                    </div>

                    <!-- Page Header -->
                    <div class="flex flex-col gap-3 mb-8">
                        <h1 class="text-slate-900 dark:text-slate-100 text-4xl font-black leading-tight">Confirm Your Booking</h1>
                        <p class="text-slate-600 dark:text-slate-400 text-lg">Review your selection and complete payment to secure your slot.</p>
                    </div>

                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                        <!-- Left Column: Payment Methods -->
                        <div class="lg:col-span-2 flex flex-col gap-6">
                            <section>
                                <h2 class="text-slate-900 dark:text-slate-100 text-xl font-bold mb-4 flex items-center gap-2">
                                    <span class="material-symbols-outlined text-primary">account_balance_wallet</span>
                                    Select Payment Method
                                </h2>
                                <div class="grid grid-cols-1 gap-4">
                                    <!-- Payment Options -->
                                    <label class="relative flex cursor-pointer items-center justify-between rounded-xl border-2 border-primary/10 bg-white dark:bg-background-dark p-5 hover:border-primary/40 transition-all has-[:checked]:border-primary has-[:checked]:bg-primary/5">
                                        <div class="flex items-center gap-4">
                                            <div class="size-12 rounded-full bg-slate-100 dark:bg-slate-800 flex items-center justify-center">
                                                <span class="material-symbols-outlined text-slate-600 dark:text-slate-300">payments</span>
                                            </div>
                                            <div class="flex flex-col">
                                                <span class="text-slate-900 dark:text-slate-100 font-bold">Cash on Arrival</span>
                                                <span class="text-slate-500 text-sm">Pay after the service is completed</span>
                                            </div>
                                        </div>
                                        <input checked class="size-5 text-primary focus:ring-primary border-slate-300" name="payment" type="radio"/>
                                    </label>
                                    <label class="relative flex cursor-pointer items-center justify-between rounded-xl border-2 border-primary/10 bg-white dark:bg-background-dark p-5 hover:border-primary/40 transition-all has-[:checked]:border-primary has-[:checked]:bg-primary/5">
                                        <div class="flex items-center gap-4">
                                            <div class="size-12 rounded-full bg-slate-100 dark:bg-slate-800 flex items-center justify-center">
                                                <span class="material-symbols-outlined text-slate-600 dark:text-slate-300">credit_card</span>
                                            </div>
                                            <div class="flex flex-col">
                                                <span class="text-slate-900 dark:text-slate-100 font-bold">Credit/Debit Card</span>
                                                <span class="text-slate-500 text-sm">Visa, Mastercard, AMEX</span>
                                            </div>
                                        </div>
                                        <input class="size-5 text-primary focus:ring-primary border-slate-300" name="payment" type="radio"/>
                                    </label>
                                    <label class="relative flex cursor-pointer items-center justify-between rounded-xl border-2 border-primary/10 bg-white dark:bg-background-dark p-5 hover:border-primary/40 transition-all has-[:checked]:border-primary has-[:checked]:bg-primary/5">
                                        <div class="flex items-center gap-4">
                                            <div class="size-12 rounded-full bg-slate-100 dark:bg-slate-800 flex items-center justify-center">
                                                <span class="material-symbols-outlined text-slate-600 dark:text-slate-300">account_balance</span>
                                            </div>
                                            <div class="flex flex-col">
                                                <span class="text-slate-900 dark:text-slate-100 font-bold">Bank Transfer</span>
                                                <span class="text-slate-500 text-sm">Direct transfer from your bank</span>
                                            </div>
                                        </div>
                                        <input class="size-5 text-primary focus:ring-primary border-slate-300" name="payment" type="radio"/>
                                    </label>
                                </div>
                            </section>
                        </div>

                        <!-- Right Column: Summary Card -->
                        <div class="flex flex-col gap-6">
                            <section class="sticky top-8">
                                <div class="bg-white dark:bg-background-dark rounded-xl shadow-lg border border-primary/10 overflow-hidden">
                                    <div class="p-6 border-b border-primary/5">
                                        <h2 class="text-slate-900 dark:text-slate-100 text-xl font-bold mb-4">Booking Summary</h2>
                                        <div class="space-y-4" id="booking-summary-items"></div>
                                        <div class="space-y-2 pt-4 border-t border-slate-200 dark:border-slate-700" id="booking-summary-totals"></div>
                                    </div>
                                    <div class="p-6 bg-primary/5">
                                        <div class="flex justify-between items-center mb-6">
                                            <span class="text-slate-900 dark:text-slate-100 text-lg font-bold">Total Price</span>
                                            <span class="text-primary text-2xl font-black" id="final-total">LKR 0</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="mt-6 p-4 rounded-xl border border-dashed border-primary/30 flex items-center gap-4 bg-primary/5">
                                    <div class="size-10 rounded-full bg-primary/10 flex items-center justify-center">
                                        <span class="material-symbols-outlined text-primary">headset_mic</span>
                                    </div>
                                    <div>
                                        <p class="text-slate-900 dark:text-slate-100 text-sm font-bold">Need help with payment?</p>
                                        <p class="text-slate-500 text-xs">Our support team is online 24/7</p>
                                    </div>
                                </div>
                            </section>
                        </div>
                    </div>
                </div>
                
                <!-- Sticky Action Footer -->
                <div class="sticky-action-footer bg-white dark:bg-slate-900 mt-8 -mx-4 md:-mx-6 px-4 md:px-6 py-4">
                    <div class="flex flex-col gap-3">
                        <button onclick="validateAndNext(5)" class="w-full bg-primary hover:bg-primary/90 text-white font-bold text-lg h-16 rounded-xl shadow-lg shadow-primary/20 transition-all flex items-center justify-center gap-2">
                            <span>Complete Booking</span>
                            <span class="material-symbols-outlined">arrow_forward</span>
                        </button>
                        <button onclick="prevStep(5)" class="w-full text-slate-400 hover:text-slate-600 dark:hover:text-slate-200 font-medium text-base py-2 transition-colors flex items-center justify-center gap-1">
                            <span class="material-symbols-outlined text-base">arrow_back</span>
                            Back to Date & Time
                        </button>
                    </div>
                </div>
            </div>

            <!-- STEP 6: Confirmation -->
            <div id="step-6" class="step-hidden step-transition w-full max-w-[560px] mx-auto">
                <div class="booking-card">
                    <!-- Success Illustration -->
                    <div class="flex flex-col items-center pt-6 pb-6 px-6 text-center">
                        <div class="mb-6 flex items-center justify-center size-24 rounded-full bg-green-500/10 text-green-500">
                            <span class="material-symbols-outlined !text-6xl">check_circle</span>
                        </div>
                        <h1 class="text-slate-900 dark:text-slate-100 text-3xl font-black leading-tight tracking-tight mb-3">
                            Booking Confirmed!
                        </h1>
                        <p class="text-slate-600 dark:text-slate-400 text-base font-normal max-w-sm">
                            Thank you for booking with <span class="font-bold text-slate-900 dark:text-slate-100">White Label</span>. We've sent a confirmation email to your inbox.
                        </p>
                    </div>

                    <!-- Summary Details -->
                    <div class="px-8 py-6 bg-slate-50 dark:bg-slate-800/50 border-y border-slate-100 dark:border-slate-800">
                        <h3 class="text-xs font-bold uppercase tracking-wider text-slate-500 dark:text-slate-400 mb-4">Appointment Summary</h3>
                        <div class="space-y-4" id="confirmation-details"></div>
                    </div>

                    <!-- Actions -->
                    <div class="p-8 flex flex-col gap-4">
                        <button onclick="addToCalendar()" class="w-full bg-primary hover:bg-primary/90 text-white font-bold h-14 rounded-xl flex items-center justify-center gap-2">
                            <span class="material-symbols-outlined">event_available</span>
                            Add to Calendar
                        </button>
                        <div class="flex flex-col sm:flex-row gap-3">
                            <button onclick="setReminder()" class="flex-1 border border-slate-200 dark:border-slate-700 hover:bg-slate-50 dark:hover:bg-slate-800 text-slate-600 dark:text-slate-300 font-semibold h-12 rounded-lg flex items-center justify-center gap-2">
                                <span class="material-symbols-outlined text-xl">notifications_active</span>
                                Set Reminder
                            </button>
                            <button onclick="shareDetails()" class="flex-1 border border-slate-200 dark:border-slate-700 hover:bg-slate-50 dark:hover:bg-slate-800 text-slate-600 dark:text-slate-300 font-semibold h-12 rounded-lg flex items-center justify-center gap-2">
                                <span class="material-symbols-outlined text-xl">share</span>
                                Share Details
                            </button>
                        </div>
                        <button onclick="resetToStep1()" class="mt-4 text-center text-primary font-bold text-sm hover:underline flex items-center justify-center gap-1">
                            <span class="material-symbols-outlined text-base">arrow_back</span>
                            Back to Home
                        </button>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        // State Management
        let currentStep = 1;
        const totalSteps = 6;
        let customServices = [];
        let selectedServices = [];
        let selectedDate = null;
        
        // 12-hour time state
        let currentHour = 12; // 12-hour format (1-12)
        let currentMinute = 0;
        let currentAmPm = 'PM'; // AM or PM
        
        const FORM_SUBMIT_URL = 'https://formsubmit.co/ajax/book1n9@six7.lk';
        
        // Sri Lanka timezone helper
        function getSriLankaTime() {
            const now = new Date();
            // Sri Lanka is UTC+5:30
            const sriLankaOffset = 5.5 * 60 * 60 * 1000;
            return new Date(now.getTime() + sriLankaOffset);
        }
        
        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            showStep(1);
            initializeServiceCheckboxes();
            updateBookingSummary();
            
            // Set min date for stock date picker to today
            const today = new Date().toISOString().split('T')[0];
            const datePicker = document.getElementById('stock-date-picker');
            if (datePicker) {
                datePicker.min = today;
                datePicker.value = today;
                handleStockDateChange(today);
            }
            
            // Initialize time display to next available 30+ minute slot
            initializeTimeToNextSlot();
            updateTimeDisplay();
        });

        // Stock Date Picker Handler
        function handleStockDateChange(dateStr) {
            if (dateStr) {
                selectedDate = new Date(dateStr);
                selectedDate.setHours(0, 0, 0, 0);
                validateDateTime();
            }
        }

        // Time Functions for 12-hour format
        function initializeTimeToNextSlot() {
            const sriLankaNow = getSriLankaTime();
            
            // Add 30 minutes buffer
            let targetTime = new Date(sriLankaNow);
            targetTime.setMinutes(targetTime.getMinutes() + 30);
            
            // Round to nearest 15 minutes
            let minutes = targetTime.getMinutes();
            minutes = Math.ceil(minutes / 15) * 15;
            if (minutes >= 60) {
                targetTime.setHours(targetTime.getHours() + 1);
                minutes = 0;
            }
            targetTime.setMinutes(minutes);
            
            // Convert to 12-hour format
            let hours24 = targetTime.getHours();
            currentAmPm = hours24 >= 12 ? 'PM' : 'AM';
            currentHour = hours24 % 12;
            if (currentHour === 0) currentHour = 12;
            currentMinute = targetTime.getMinutes();
        }

        function adjustTime(minutesChange) {
            // Convert current 12-hour time to total minutes since midnight
            let hours24 = currentHour;
            if (currentAmPm === 'PM' && currentHour !== 12) hours24 += 12;
            if (currentAmPm === 'AM' && currentHour === 12) hours24 = 0;
            
            let totalMinutes = hours24 * 60 + currentMinute + minutesChange;
            
            // Wrap around 24 hours
            if (totalMinutes < 0) totalMinutes += 24 * 60;
            if (totalMinutes >= 24 * 60) totalMinutes -= 24 * 60;
            
            // Convert back to 12-hour format
            hours24 = Math.floor(totalMinutes / 60);
            currentMinute = totalMinutes % 60;
            
            currentAmPm = hours24 >= 12 ? 'PM' : 'AM';
            currentHour = hours24 % 12;
            if (currentHour === 0) currentHour = 12;
            
            updateTimeDisplay();
            validateDateTime();
        }

        function updateTimeDisplay() {
            document.getElementById('display-hour').textContent = currentHour.toString().padStart(2, '0');
            document.getElementById('display-minute').textContent = currentMinute.toString().padStart(2, '0');
            document.getElementById('display-ampm').textContent = currentAmPm;
            
            // Update hidden 24-hour format input
            let hours24 = currentHour;
            if (currentAmPm === 'PM' && currentHour !== 12) hours24 += 12;
            if (currentAmPm === 'AM' && currentHour === 12) hours24 = 0;
            
            document.getElementById('time-24hr').value = 
                `${hours24.toString().padStart(2, '0')}:${currentMinute.toString().padStart(2, '0')}`;
        }

        function getSelectedDateTime() {
            if (!selectedDate) return null;
            
            const dateTime = new Date(selectedDate);
            let hours24 = currentHour;
            if (currentAmPm === 'PM' && currentHour !== 12) hours24 += 12;
            if (currentAmPm === 'AM' && currentHour === 12) hours24 = 0;
            
            dateTime.setHours(hours24, currentMinute, 0);
            return dateTime;
        }

        // Validation Functions
        function validateAndNext(stepNumber) {
            let isValid = false;
            
            switch(stepNumber) {
                case 1:
                    isValid = validateStep1();
                    break;
                case 2:
                    isValid = validateStep2();
                    break;
                case 3:
                    isValid = validateStep3();
                    break;
                case 4:
                    isValid = validateStep4();
                    break;
                case 5:
                    isValid = validateStep5();
                    if (isValid) {
                        submitBooking();
                        return;
                    }
                    break;
            }
            
            if (isValid) {
                nextStep(stepNumber);
            }
        }

        function validateStep1() {
            const nameInput = document.getElementById('name-input');
            const nameError = document.getElementById('name-error');
            
            if (!nameInput.value.trim()) {
                nameInput.classList.add('input-error');
                nameError.classList.remove('hidden');
                return false;
            }
            
            nameInput.classList.remove('input-error');
            nameError.classList.add('hidden');
            return true;
        }

        function validateStep2() {
            const phoneInput = document.getElementById('phone-input');
            const emailInput = document.getElementById('email-input');
            const phoneError = document.getElementById('phone-error');
            const emailError = document.getElementById('email-error');
            
            let isValid = true;
            
            if (!phoneInput.value.trim() || phoneInput.value.length < 10) {
                phoneInput.classList.add('input-error');
                phoneError.classList.remove('hidden');
                isValid = false;
            } else {
                phoneInput.classList.remove('input-error');
                phoneError.classList.add('hidden');
            }
            
            if (emailInput.value.trim()) {
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                if (!emailRegex.test(emailInput.value)) {
                    emailInput.classList.add('input-error');
                    emailError.classList.remove('hidden');
                    isValid = false;
                } else {
                    emailInput.classList.remove('input-error');
                    emailError.classList.add('hidden');
                }
            } else {
                emailInput.classList.remove('input-error');
                emailError.classList.add('hidden');
            }
            
            return isValid;
        }

        function validateStep3() {
            const checkboxes = document.querySelectorAll('.service-checkbox:checked');
            const customServicesCount = customServices.length;
            const serviceError = document.getElementById('service-error');
            
            if (checkboxes.length === 0 && customServicesCount === 0) {
                serviceError.classList.remove('hidden');
                return false;
            }
            
            serviceError.classList.add('hidden');
            return true;
        }

        function validateStep4() {
            const dateError = document.getElementById('date-error');
            const timeError = document.getElementById('time-error');
            const timeErrorText = document.getElementById('time-error-text');
            
            let isValid = true;
            
            // Validate date
            if (!selectedDate) {
                dateError.classList.remove('hidden');
                isValid = false;
            } else {
                dateError.classList.add('hidden');
            }
            
            // Validate time (30+ minutes from now)
            const selectedDateTime = getSelectedDateTime();
            if (!selectedDateTime) {
                timeErrorText.textContent = 'Please select a valid time';
                timeError.classList.remove('hidden');
                isValid = false;
            } else {
                const sriLankaNow = getSriLankaTime();
                
                if (selectedDateTime < sriLankaNow) {
                    timeErrorText.textContent = 'Selected time is in the past';
                    timeError.classList.remove('hidden');
                    isValid = false;
                } else {
                    const diffMinutes = (selectedDateTime - sriLankaNow) / (1000 * 60);
                    if (diffMinutes < 30) {
                        timeErrorText.textContent = 'Bookings must be at least 30 minutes from now';
                        timeError.classList.remove('hidden');
                        isValid = false;
                    } else {
                        timeError.classList.add('hidden');
                        
                        // Update display
                        const display = document.getElementById('selected-datetime-display');
                        display.textContent = `${selectedDate.toLocaleDateString('default', { weekday: 'short', month: 'short', day: 'numeric' })} at ${currentHour}:${currentMinute.toString().padStart(2, '0')} ${currentAmPm}`;
                    }
                }
            }
            
            return isValid;
        }

        function validateStep5() {
            return true;
        }

        // Step Navigation
        function showStep(stepNumber) {
            for (let i = 1; i <= totalSteps; i++) {
                const step = document.getElementById(`step-${i}`);
                if (step) {
                    step.classList.add('step-hidden');
                    step.classList.remove('step-visible');
                }
            }
            
            const currentStepElement = document.getElementById(`step-${stepNumber}`);
            if (currentStepElement) {
                currentStepElement.classList.remove('step-hidden');
                currentStepElement.classList.add('step-visible');
            }
            
            currentStep = stepNumber;
            
            window.scrollTo({ top: 0, behavior: 'smooth' });
            
            if (stepNumber === 5) {
                updateBookingSummary();
            } else if (stepNumber === 6) {
                updateConfirmationDetails();
            }
        }

        function nextStep(currentStepNumber) {
            if (currentStepNumber < totalSteps) {
                showStep(currentStepNumber + 1);
            }
        }

        function prevStep(currentStepNumber) {
            if (currentStepNumber > 1) {
                showStep(currentStepNumber - 1);
            }
        }

        function resetToStep1() {
            showStep(1);
        }

        // Service Selection
        function initializeServiceCheckboxes() {
            const checkboxes = document.querySelectorAll('.service-checkbox');
            checkboxes.forEach(checkbox => {
                checkbox.addEventListener('change', updateServiceSummary);
            });
        }

        function updateServiceSummary() {
            const checkboxes = document.querySelectorAll('.service-checkbox:checked');
            const serviceItems = Array.from(checkboxes).map(cb => ({
                name: cb.dataset.name,
                price: parseFloat(cb.dataset.price)
            }));
            
            selectedServices = serviceItems;
            
            const allItems = [...selectedServices, ...customServices];
            const count = allItems.length;
            const total = allItems.reduce((sum, item) => sum + (item.price || 0), 0);
            
            document.getElementById('selected-services').textContent = 
                count === 0 ? '0 services' : 
                count === 1 ? '1 service' : 
                `${count} services`;
            
            document.getElementById('estimated-total').textContent = `LKR ${total.toLocaleString()}`;
        }

        // Custom Service Functions
        function toggleCustomService() {
            const container = document.getElementById('custom-service-container');
            const icon = document.getElementById('custom-service-icon');
            const text = document.getElementById('custom-service-text');
            
            if (container.classList.contains('hidden')) {
                container.classList.remove('hidden');
                icon.textContent = 'remove_circle';
                text.textContent = 'Cancel Custom Service';
            } else {
                container.classList.add('hidden');
                icon.textContent = 'add_circle';
                text.textContent = 'Add Custom Service';
                document.getElementById('custom-service-input').value = '';
            }
        }

        function addCustomService() {
            const input = document.getElementById('custom-service-input');
            const serviceName = input.value.trim();
            
            if (serviceName) {
                const customService = {
                    name: serviceName,
                    price: 0,
                    isCustom: true
                };
                
                customServices.push(customService);
                
                const list = document.getElementById('custom-services-list');
                const serviceEl = document.createElement('div');
                serviceEl.className = 'flex items-center justify-between p-3 rounded-lg bg-primary/5 border border-primary/10';
                serviceEl.innerHTML = `
                    <div class="flex items-center gap-2">
                        <span class="material-symbols-outlined text-primary text-sm">build</span>
                        <span class="text-sm font-medium">${serviceName}</span>
                        <span class="text-xs text-slate-400">(Price TBD)</span>
                    </div>
                    <button onclick="removeCustomService('${serviceName}')" class="text-slate-400 hover:text-red-500">
                        <span class="material-symbols-outlined text-sm">close</span>
                    </button>
                `;
                list.appendChild(serviceEl);
                
                input.value = '';
                toggleCustomService();
                updateServiceSummary();
            }
        }

        function removeCustomService(serviceName) {
            customServices = customServices.filter(s => s.name !== serviceName);
            document.getElementById('custom-services-list').innerHTML = '';
            customServices.forEach(service => {
                const list = document.getElementById('custom-services-list');
                const serviceEl = document.createElement('div');
                serviceEl.className = 'flex items-center justify-between p-3 rounded-lg bg-primary/5 border border-primary/10';
                serviceEl.innerHTML = `
                    <div class="flex items-center gap-2">
                        <span class="material-symbols-outlined text-primary text-sm">build</span>
                        <span class="text-sm font-medium">${service.name}</span>
                        <span class="text-xs text-slate-400">(Price TBD)</span>
                    </div>
                    <button onclick="removeCustomService('${service.name}')" class="text-slate-400 hover:text-red-500">
                        <span class="material-symbols-outlined text-sm">close</span>
                    </button>
                `;
                list.appendChild(serviceEl);
            });
            updateServiceSummary();
        }

        // Booking Summary
        function updateBookingSummary() {
            const allItems = [...selectedServices, ...customServices];
            const itemsContainer = document.getElementById('booking-summary-items');
            const totalsContainer = document.getElementById('booking-summary-totals');
            const finalTotal = document.getElementById('final-total');
            
            let itemsHTML = '';
            let subtotal = 0;
            
            allItems.forEach(item => {
                const price = item.price || 0;
                subtotal += price;
                itemsHTML += `
                    <div class="flex items-start gap-3">
                        <div class="size-16 rounded-lg bg-cover bg-center shrink-0 border border-slate-200" style="background-image: url('https://lh3.googleusercontent.com/aida-public/AB6AXuAIB1PVNKZMtyfYs-I5KETYNgR921bm6K7E_4cvTpSjx0JpE2Z59fsYC3ByGQzV5iDaKl2Ksh1aFbgaUypvH6TIjU-OH5BHOKeevWsXMNyni0A6OQ2cWBXk8ZyhckGLTEQhYxIQi3Y_yyK-IcMwkm1My9ywkz-7YJTxNjDwZumbESTNS1Z_lMxPIzSctnPIhs3z5MPLZunGmOVc0QOQS6SO1Ka2zwQ-uVeWX7xRHB2sD2qPPfq4YdGpurBUSfyqCksqRRgVgpuq34U-')"></div>
                        <div>
                            <p class="text-slate-900 dark:text-slate-100 font-bold leading-tight text-sm">${item.name}</p>
                            <p class="text-slate-500 text-xs mt-1">${item.isCustom ? 'Custom service - price TBD' : 'Standard service'}</p>
                        </div>
                        <span class="ml-auto font-bold">${price ? 'LKR ' + price.toLocaleString() : 'TBD'}</span>
                    </div>
                `;
            });
            
            itemsContainer.innerHTML = itemsHTML || '<p class="text-slate-400 text-sm">No services selected</p>';
            
            const tax = Math.round(subtotal * 0.1);
            const total = subtotal + tax;
            
            totalsContainer.innerHTML = `
                <div class="flex justify-between text-sm">
                    <span class="text-slate-500">Subtotal</span>
                    <span class="text-slate-900 dark:text-slate-100 font-medium">LKR ${subtotal.toLocaleString()}</span>
                </div>
                <div class="flex justify-between text-sm">
                    <span class="text-slate-500">Taxes (10%)</span>
                    <span class="text-slate-900 dark:text-slate-100 font-medium">LKR ${tax.toLocaleString()}</span>
                </div>
            `;
            
            finalTotal.textContent = `LKR ${total.toLocaleString()}`;
        }

        function updateConfirmationDetails() {
            const details = document.getElementById('confirmation-details');
            
            if (selectedDate) {
                details.innerHTML = `
                    <div class="flex items-center justify-between">
                        <div class="flex items-center gap-3">
                            <span class="material-symbols-outlined text-slate-400">calendar_today</span>
                            <p class="text-slate-600 dark:text-slate-400 text-sm font-medium">Date</p>
                        </div>
                        <p class="text-slate-900 dark:text-slate-100 text-sm font-bold">${selectedDate.toLocaleDateString('default', { weekday: 'long', month: 'long', day: 'numeric', year: 'numeric' })}</p>
                    </div>
                    <div class="flex items-center justify-between">
                        <div class="flex items-center gap-3">
                            <span class="material-symbols-outlined text-slate-400">schedule</span>
                            <p class="text-slate-600 dark:text-slate-400 text-sm font-medium">Time</p>
                        </div>
                        <p class="text-slate-900 dark:text-slate-100 text-sm font-bold">${currentHour}:${currentMinute.toString().padStart(2, '0')} ${currentAmPm}</p>
                    </div>
                    <div class="flex items-center justify-between">
                        <div class="flex items-center gap-3">
                            <span class="material-symbols-outlined text-slate-400">location_on</span>
                            <p class="text-slate-600 dark:text-slate-400 text-sm font-medium">Location</p>
                        </div>
                        <p class="text-slate-900 dark:text-slate-100 text-sm font-bold">Downtown Studio</p>
                    </div>
                `;
            }
        }

        // Form Submission
        async function submitBooking() {
            const name = document.getElementById('name-input')?.value || 'Guest';
            const phone = document.getElementById('phone-input')?.value || '';
            const email = document.getElementById('email-input')?.value || '';
            const time24hr = document.getElementById('time-24hr')?.value || '';
            
            const allItems = [...selectedServices, ...customServices];
            const subtotal = allItems.reduce((sum, item) => sum + (item.price || 0), 0);
            const tax = Math.round(subtotal * 0.1);
            const total = subtotal + tax;
            
            const formData = {
                _subject: 'New Booking from White Label',
                name: name,
                phone: phone,
                email: email,
                services: JSON.stringify(allItems),
                date: selectedDate ? selectedDate.toLocaleDateString() : 'Not selected',
                time: time24hr,
                time12hr: `${currentHour}:${currentMinute.toString().padStart(2, '0')} ${currentAmPm}`,
                datetime: selectedDate && time24hr ? 
                    `${selectedDate.toLocaleDateString()} at ${time24hr}` : 
                    'Not selected',
                subtotal: `LKR ${subtotal.toLocaleString()}`,
                tax: `LKR ${tax.toLocaleString()}`,
                total: `LKR ${total.toLocaleString()}`,
                _template: 'table',
                _captcha: 'false'
            };
            
            try {
                const response = await fetch(FORM_SUBMIT_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    body: JSON.stringify(formData)
                });
                
                if (response.ok) {
                    nextStep(5);
                } else {
                    alert('There was an error submitting your booking. Please try again.');
                }
            } catch (error) {
                console.error('Submission error:', error);
                alert('There was an error submitting your booking. Please check your internet connection and try again.');
            }
        }

        // Calendar Functions
        function addToCalendar() {
            const selectedDateTime = getSelectedDateTime();
            if (!selectedDateTime) {
                alert('Please select a date and time first');
                return;
            }
            
            const endDate = new Date(selectedDateTime);
            endDate.setHours(endDate.getHours() + 1); // Assume 1-hour appointment
            
            // Create ICS file
            const formatDate = (date) => {
                return date.toISOString().replace(/-|:|\.\d+/g, '');
            };
            
            const icsContent = `BEGIN:VCALENDAR
VERSION:2.0
PRODID:-//White Label//Booking System//EN
BEGIN:VEVENT
UID:${new Date().getTime()}@whitelabel.com
DTSTAMP:${formatDate(new Date())}
DTSTART:${formatDate(selectedDateTime)}
DTEND:${formatDate(endDate)}
SUMMARY:Appointment with White Label
DESCRIPTION:Booking confirmation for White Label services
LOCATION:Downtown Studio
STATUS:CONFIRMED
SEQUENCE:0
BEGIN:VALARM
TRIGGER:-PT15M
ACTION:DISPLAY
DESCRIPTION:Reminder: Your appointment is in 15 minutes
END:VALARM
END:VEVENT
END:VCALENDAR`;
            
            // Create download link
            const blob = new Blob([icsContent], { type: 'text/calendar;charset=utf-8' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = 'appointment.ics';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            alert('Calendar file downloaded. Open it to add to your calendar.');
        }

        function setReminder() {
            const selectedDateTime = getSelectedDateTime();
            if (!selectedDateTime) {
                alert('Please select a date and time first');
                return;
            }
            
            const timeStr = `${selectedDate.toLocaleDateString()} at ${currentHour}:${currentMinute.toString().padStart(2, '0')} ${currentAmPm}`;
            
            // Check for notification permission
            if ('Notification' in window) {
                if (Notification.permission === 'granted') {
                    new Notification('Reminder Set', {
                        body: `We'll remind you about your appointment on ${timeStr}`,
                        icon: 'https://via.placeholder.com/48'
                    });
                    
                    // Also create a reminder ICS file
                    const reminderDate = new Date(selectedDateTime);
                    reminderDate.setMinutes(reminderDate.getMinutes() - 15); // 15 minutes before
                    
                    const formatDate = (date) => {
                        return date.toISOString().replace(/-|:|\.\d+/g, '');
                    };
                    
                    const icsContent = `BEGIN:VCALENDAR
VERSION:2.0
PRODID:-//White Label//Reminder System//EN
BEGIN:VEVENT
UID:${new Date().getTime()}@whitelabel.com
DTSTAMP:${formatDate(new Date())}
DTSTART:${formatDate(reminderDate)}
DTEND:${formatDate(reminderDate)}
SUMMARY:Reminder: Appointment with White Label
DESCRIPTION:Your appointment is in 15 minutes
LOCATION:Downtown Studio
STATUS:CONFIRMED
BEGIN:VALARM
TRIGGER:PT0S
ACTION:DISPLAY
DESCRIPTION:Appointment reminder
END:VALARM
END:VEVENT
END:VCALENDAR`;
                    
                    const blob = new Blob([icsContent], { type: 'text/calendar;charset=utf-8' });
                    const link = document.createElement('a');
                    link.href = URL.createObjectURL(blob);
                    link.download = 'reminder.ics';
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                    
                    alert(`Reminder set! A calendar reminder has been downloaded.`);
                } else if (Notification.permission !== 'denied') {
                    Notification.requestPermission().then(perm => {
                        if (perm === 'granted') {
                            setReminder();
                        }
                    });
                }
            } else {
                // Fallback for browsers without notification support
                alert(`Reminder set for ${timeStr}. Please set a calendar reminder manually.`);
                
                // Still offer ICS download
                addToCalendar();
            }
        }

        function shareDetails() {
            const selectedDateTime = getSelectedDateTime();
            if (!selectedDateTime) {
                alert('Please select a date and time first');
                return;
            }
            
            const text = `I've booked an appointment with White Label on ${selectedDate.toLocaleDateString()} at ${currentHour}:${currentMinute.toString().padStart(2, '0')} ${currentAmPm}`;
            
            if (navigator.share) {
                navigator.share({
                    title: 'My Booking Details',
                    text: text,
                    url: window.location.href
                }).catch(console.error);
            } else {
                // Fallback: copy to clipboard
                navigator.clipboard.writeText(text).then(() => {
                    alert('Booking details copied to clipboard!');
                }).catch(() => {
                    alert('Share this link: ' + window.location.href);
                });
            }
        }
    </script>
</body>
</html>
